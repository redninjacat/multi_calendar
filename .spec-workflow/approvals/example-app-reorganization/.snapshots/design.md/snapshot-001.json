{
  "id": "snapshot_1771209778599_si47uvbjn",
  "approvalId": "approval_1771209778593_m6atzhych",
  "approvalTitle": "Design: Example App Reorganization",
  "version": 1,
  "timestamp": "2026-02-16T02:42:58.599Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis design reorganizes the multi_calendar example app from its current asymmetric structure (6 Month View tabs, 9 Day View tabs) into a unified 5-tab structure per view (Features, Theme, Styles, Stress Test, Accessibility). It introduces a shared responsive control panel component, separates widget configuration from theme customization, fully localizes all user-facing text across 5 languages, and adds new tabs (Month View Stress Test and Accessibility). The Comparison view remains unchanged.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\nNo steering documents exist. The design follows established codebase patterns:\n- Flutter widget composition with StatefulWidget\n- Builder callback pattern for customization\n- `MCalTheme` / `MCalThemeData` for theming\n- `flutter_localizations` + ARB files for i18n\n- `MCalEventController` as the single source of event state\n\n### Project Structure (structure.md)\n\nNo steering documents exist. The design follows the existing package convention:\n- Example app lives under `example/lib/`\n- Views organized by calendar view type\n- Shared widgets and utilities in dedicated directories\n- Localization via ARB files in `l10n/`\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **`MCalEventController`**: Used as-is across all tabs for event management\n- **`MCalTheme` / `MCalThemeData`**: Used for theme customization in Theme tabs and style showcase\n- **`MCalMonthThemeData` / `MCalDayThemeData`**: View-specific theme settings exposed in Theme tabs\n- **`createSampleEvents()`**: Reused for standard sample data across Features, Theme, Styles, and Accessibility tabs\n- **`createDayViewSampleEvents()`**: Reused for Day View sample data\n- **`createDayViewStressTestEvents()`**: Reused for Day View stress test\n- **`getEventColor()` / `eventColors`**: Reused for consistent event coloring\n- **`showEventDetailDialog()`**: Reused across all tabs with event tap handlers\n- **`showDayEventsBottomSheet()`**: Reused for Month View overflow indicators\n- **`DayViewCrudHelper` mixin**: Reused for Day View CRUD operations\n- **`showDayViewEventCreateDialog()` / `showDayViewEventEditDialog()`**: Reused for Day View event forms\n- **`RecurrenceEditorDialog`**: Reused for recurring event editing\n- **`RecurrenceEditScopeDialog`**: Reused for recurring event scope selection\n- **Existing style widgets** (Modern, Classic, Minimal, Colorful for both views): Retained with minimal modification in Styles tabs\n\n### Integration Points\n\n- **ARB localization system**: All new strings added to existing ARB infrastructure\n- **`MCalLocalizations`** (package-level): Used for calendar-specific strings\n- **`AppLocalizations`** (example-level): Extended with ~200+ new keys for full localization\n- **`NavigationRail`**: Existing main screen navigation retained\n\n## Architecture\n\n### Modular Design Principles\n\n- **Single File Responsibility**: Each tab is a single file; each style is a single file; each dialog is a single file\n- **Component Isolation**: The responsive control panel is a standalone widget reusable across all tabs\n- **Separation of Concerns**: Features tab handles widget params only; Theme tab handles theme params only; Styles tab handles pre-built configurations\n- **Utility Modularity**: Sample data generators, date formatters, and event colors remain isolated utilities\n\n### Directory Structure\n\n```\nexample/lib/\n  main.dart\n  l10n/\n    app_en.arb\n    app_es.arb\n    app_fr.arb\n    app_ar.arb\n    app_he.arb\n    app_localizations.dart          (generated)\n  screens/\n    main_screen.dart\n  shared/\n    widgets/\n      responsive_control_panel.dart    # Responsive layout shell\n      control_panel_section.dart       # Collapsible section with header\n      control_widgets.dart             # Toggle, slider, dropdown, color picker helpers\n      event_detail_dialog.dart         # Localized event detail dialog\n      event_form_dialog.dart           # Localized create/edit event dialog\n      day_events_bottom_sheet.dart     # Localized overflow bottom sheet\n      recurrence_editor_dialog.dart    # Localized RRULE editor\n      recurrence_edit_scope_dialog.dart  # Localized scope chooser\n      style_description.dart           # Style description banner\n      snackbar_helper.dart             # Consistent SnackBar display helper\n    utils/\n      sample_events.dart               # Month + Day sample events\n      stress_test_events.dart          # Month + Day stress test event generators\n      date_formatters.dart             # Locale-aware date formatting\n      event_colors.dart                # Event color palette\n      theme_presets.dart               # Shared theme preset definitions\n  views/\n    month_view/\n      month_view_showcase.dart         # 5-tab controller\n      tabs/\n        month_features_tab.dart        # Widget settings + interactions\n        month_theme_tab.dart           # Theme settings + presets\n        month_styles_tab.dart          # Dropdown style switcher\n        month_stress_test_tab.dart     # Performance testing\n        month_accessibility_tab.dart   # Keyboard + screen reader + high contrast\n      styles/\n        month_default_style.dart\n        month_modern_style.dart\n        month_classic_style.dart\n        month_minimal_style.dart\n        month_colorful_style.dart\n    day_view/\n      day_view_showcase.dart           # 5-tab controller\n      tabs/\n        day_features_tab.dart          # Widget settings + interactions\n        day_theme_tab.dart             # Theme settings + presets\n        day_styles_tab.dart            # Dropdown style switcher\n        day_stress_test_tab.dart       # Performance testing\n        day_accessibility_tab.dart     # Keyboard + screen reader + high contrast\n      styles/\n        day_default_style.dart\n        day_modern_style.dart\n        day_classic_style.dart\n        day_minimal_style.dart\n        day_colorful_style.dart\n    comparison/\n      comparison_view.dart             # Unchanged from current\n```\n\n### Component Relationship Diagram\n\n```\nMainScreen\n  NavigationRail [Month View | Day View | Comparison]\n    MonthViewShowcase\n      TabBar [Features | Theme | Styles | Stress Test | Accessibility]\n        MonthFeaturesTab\n          ResponsiveControlPanel (widget settings)\n          MCalMonthView (configured by settings)\n        MonthThemeTab\n          ResponsiveControlPanel (theme settings + presets)\n          MCalTheme + MCalMonthView\n        MonthStylesTab\n          Dropdown (style selector)\n          StyleDescription\n          SelectedStyle widget (Default/Modern/Classic/Minimal/Colorful)\n        MonthStressTestTab\n          ResponsiveControlPanel (stress controls)\n          MCalMonthView (stress events)\n        MonthAccessibilityTab\n          Keyboard shortcuts reference\n          Screen reader guide\n          High contrast toggle\n          MCalMonthView (accessible config)\n    DayViewShowcase\n      TabBar [Features | Theme | Styles | Stress Test | Accessibility]\n        (mirrors Month structure with Day View specifics)\n    ComparisonView (unchanged)\n```\n\n## Components and Interfaces\n\n### Component 1: ResponsiveControlPanel\n\n- **Purpose**: Provides a responsive layout shell that positions a control panel either at the top (collapsible, phone/tablet) or as a right sidebar (desktop)\n- **Interfaces**:\n  - `ResponsiveControlPanel({required Widget child, required Widget controlPanel, double sidebarWidth = 300, double breakpoint = 900})`\n  - The `child` is the calendar widget\n  - The `controlPanel` is the settings content\n- **Dependencies**: `MediaQuery` for responsive breakpoint detection\n- **Reuses**: N/A (new shared component)\n- **Behavior**:\n  - Width >= `breakpoint`: `Row` with `[child (Expanded), controlPanel (fixed width)]`\n  - Width < `breakpoint`: `Column` with `[ExpansionTile controlPanel, child (Expanded)]`\n  - Consistent border/padding treatment regardless of layout mode\n\n### Component 2: ControlPanelSection\n\n- **Purpose**: A collapsible section within a control panel with a styled header\n- **Interfaces**:\n  - `ControlPanelSection({required String title, required List<Widget> children, bool initiallyExpanded = true})`\n- **Dependencies**: Material `ExpansionTile`\n- **Reuses**: N/A (new shared component)\n- **Behavior**: Groups related settings under a titled, collapsible section\n\n### Component 3: ControlWidgets (static helpers)\n\n- **Purpose**: Consistent building blocks for control panel settings\n- **Interfaces**:\n  - `ControlWidgets.toggle({required String label, required bool value, required ValueChanged<bool> onChanged})`\n  - `ControlWidgets.slider({required String label, required double value, required double min, required double max, int? divisions, required ValueChanged<double> onChanged})`\n  - `ControlWidgets.dropdown<T>({required String label, required T value, required List<DropdownMenuItem<T>> items, required ValueChanged<T?> onChanged})`\n  - `ControlWidgets.colorPicker({required String label, required Color value, required ValueChanged<Color> onChanged})`\n  - `ControlWidgets.presetChips<T>({required String label, required T selected, required List<T> presets, required String Function(T) labelBuilder, required ValueChanged<T> onChanged})`\n- **Dependencies**: Material widgets\n- **Reuses**: N/A (new shared component)\n\n### Component 4: SnackBarHelper\n\n- **Purpose**: Consistent SnackBar display with localized messages\n- **Interfaces**:\n  - `SnackBarHelper.show(BuildContext context, String message)`\n  - Clears previous SnackBar before showing new one\n  - Consistent duration, styling, and dismissal behavior\n- **Dependencies**: `ScaffoldMessenger`\n- **Reuses**: N/A (new shared component)\n\n### Component 5: MonthViewShowcase / DayViewShowcase\n\n- **Purpose**: Tab controller host for each view's 5 tabs\n- **Interfaces**:\n  - `MonthViewShowcase()` / `DayViewShowcase()`\n  - Internal `TabController` with 5 tabs\n  - Tab labels loaded from `AppLocalizations`\n- **Dependencies**: Tab widgets, `AppLocalizations`\n- **Reuses**: Existing showcase pattern (simplified from current)\n\n### Component 6: Features Tabs (MonthFeaturesTab / DayFeaturesTab)\n\n- **Purpose**: Interactive showcase of all widget-level parameters with live control panel\n- **Interfaces**:\n  - Stateful widgets managing all widget parameter state\n  - `ResponsiveControlPanel` wrapping the calendar and settings\n  - All gesture handlers wired with SnackBar feedback\n  - Event tap opens detail dialog; overflow opens bottom sheet\n- **Dependencies**: `ResponsiveControlPanel`, `ControlPanelSection`, `ControlWidgets`, `SnackBarHelper`, `MCalEventController`, sample events, shared dialogs\n- **Reuses**: Event detail dialog, bottom sheet, event form dialog, sample events, CRUD helper\n\n**Month View Features Settings (widget params only):**\n\n| Section | Settings |\n|---------|----------|\n| Navigation | `showNavigator`, `enableSwipeNavigation`, `swipeNavigationDirection`, `firstDayOfWeek` |\n| Display | `showWeekNumbers`, `maxVisibleEventsPerDay` |\n| Drag & Drop | `enableDragToMove`, `showDropTargetTiles`, `showDropTargetOverlay`, `dropTargetTilesAboveOverlay`, `dragEdgeNavigationEnabled`, `dragEdgeNavigationDelay`, `dragLongPressDelay` |\n| Resize | `enableDragToResize` |\n| Animation | `enableAnimations`, `animationDuration`, `animationCurve` |\n| Keyboard | `enableKeyboardNavigation`, `autoFocusOnCellTap` |\n| Blackout Days | Toggle + day-of-week multi-select (drives `cellInteractivityCallback` + `onDragWillAccept`) |\n\n**Day View Features Settings (widget params only):**\n\n| Section | Settings |\n|---------|----------|\n| Time Range | `startHour`, `endHour`, `timeSlotDuration`, `gridlineInterval`, `hourHeight` |\n| Navigation | `showNavigator`, `autoScrollToCurrentTime` |\n| Display | `showCurrentTimeIndicator`, `showWeekNumber`, `allDaySectionMaxRows`, `allDayToTimedDuration` |\n| Drag & Drop | `enableDragToMove`, `showDropTargetPreview`, `showDropTargetOverlay`, `dropTargetTilesAboveOverlay`, `dragEdgeNavigationEnabled`, `dragEdgeNavigationDelay`, `dragLongPressDelay` |\n| Resize | `enableDragToResize` |\n| Snapping | `snapToTimeSlots`, `snapToOtherEvents`, `snapToCurrentTime`, `snapRange` |\n| Animation | `enableAnimations`, `animationDuration` |\n| Keyboard | `enableKeyboardNavigation`, `autoFocusOnEventTap` |\n| Time Regions | Toggle special time regions, toggle blackout times |\n\n### Component 7: Theme Tabs (MonthThemeTab / DayThemeTab)\n\n- **Purpose**: Live theme customization with presets and granular controls\n- **Interfaces**:\n  - Stateful widgets managing theme property state\n  - Preset selector (chips) at top\n  - Organized sections of theme controls\n  - `MCalTheme` wrapping the calendar with live-updated `MCalThemeData`\n- **Dependencies**: `ResponsiveControlPanel`, `ControlWidgets`, `MCalThemeData`, `MCalMonthThemeData`/`MCalDayThemeData`\n\n**Month View Theme Settings (curated subset):**\n\n| Section | Properties |\n|---------|-----------|\n| Cells | `cellBackgroundColor`, `cellBorderColor`, `todayBackgroundColor`, `todayTextStyle` (weight/size) |\n| Event Tiles | `eventTileBackgroundColor`, `eventTileHeight`, `eventTileCornerRadius`, `eventTileHorizontalSpacing`, `eventTileVerticalSpacing`, `eventTileBorderWidth`, `ignoreEventColors` |\n| Headers | `weekdayHeaderTextStyle` (weight/size), `weekdayHeaderBackgroundColor` |\n| Date Labels | `dateLabelHeight`, `dateLabelPosition` |\n| Overflow | `overflowIndicatorHeight` |\n| Navigator | `navigatorTextStyle` (weight/size), `navigatorBackgroundColor` |\n| Drag & Drop | `dropTargetCellValidColor`, `dropTargetCellInvalidColor`, `dragSourceOpacity`, `draggedTileElevation` |\n| Hover | `hoverCellBackgroundColor`, `hoverEventBackgroundColor` |\n| Week Numbers | `weekNumberTextStyle`, `weekNumberBackgroundColor` |\n\n**Day View Theme Settings (curated subset):**\n\n| Section | Properties |\n|---------|-----------|\n| Time Legend | `timeLegendWidth`, `timeLegendTextStyle` (weight/size), `showTimeLegendTicks`, `timeLegendTickColor`, `timeLegendTickWidth`, `timeLegendTickLength` |\n| Gridlines | `hourGridlineColor`, `hourGridlineWidth`, `majorGridlineColor`, `majorGridlineWidth`, `minorGridlineColor`, `minorGridlineWidth` |\n| Current Time | `currentTimeIndicatorColor`, `currentTimeIndicatorWidth`, `currentTimeIndicatorDotRadius` |\n| Events | `eventTileBackgroundColor`, `timedEventBorderRadius`, `timedEventMinHeight`, `timedEventPadding`, `ignoreEventColors` |\n| All-Day Events | `allDayEventBackgroundColor`, `allDayEventBorderColor`, `allDayEventBorderWidth` |\n| Time Regions | `specialTimeRegionColor`, `blockedTimeRegionColor`, `timeRegionBorderColor`, `timeRegionTextColor` |\n| Resize | `resizeHandleSize`, `minResizeDurationMinutes` |\n\n**Theme Presets (both views):**\n\n| Preset | Description |\n|--------|-------------|\n| Default | Library defaults from `MCalThemeData.fromTheme()` |\n| Compact | Reduced spacing, smaller tiles, tighter layout |\n| Spacious | Increased spacing, larger tiles, more whitespace |\n| High Contrast | High contrast colors, thicker borders, bold text |\n| Minimal | Transparent/subtle backgrounds, minimal borders, light gridlines |\n\n### Component 8: Styles Tabs (MonthStylesTab / DayStylesTab)\n\n- **Purpose**: Showcase pre-configured style variations via dropdown selector\n- **Interfaces**:\n  - Dropdown at top to select style: Default, Modern, Classic, Minimal, Colorful\n  - `StyleDescription` banner below dropdown showing localized description\n  - Selected style widget renders below\n- **Dependencies**: Style widgets, `StyleDescription`, `AppLocalizations`\n- **Reuses**: Existing style widgets from current codebase (migrated to new paths)\n\n### Component 9: Stress Test Tabs (MonthStressTestTab / DayStressTestTab)\n\n- **Purpose**: Performance testing with large event counts\n- **Interfaces**:\n  - Control panel with: stress mode toggle, event count selector (100/200/300/500), performance overlay toggle\n  - Metrics display: event count, avg frame time, FPS estimate\n- **Dependencies**: `ResponsiveControlPanel`, `MCalEventController`, stress test event generators\n- **Reuses**: Existing Day View stress test logic; new Month View stress test event generator\n\n**Month View Stress Test Event Generation:**\n- Distributes events across the visible month using random distribution\n- Clusters extra events on 3-5 random days (10-20 events each) to test overflow\n- Mix of single-day and multi-day events\n- Uses seeded RNG for reproducibility\n\n### Component 10: Accessibility Tabs (MonthAccessibilityTab / DayAccessibilityTab)\n\n- **Purpose**: Showcase accessibility features with documentation and interactive demo\n- **Interfaces**:\n  - Split layout: calendar on left/top, documentation panel on right/bottom\n  - Documentation sections: Keyboard Shortcuts, Screen Reader Guide, Accessibility Checklist, Keyboard Navigation Flow\n  - High contrast mode toggle\n  - Interactive calendar with accessibility features enabled\n- **Dependencies**: `MCalThemeData`, `AppLocalizations`\n- **Reuses**: Existing Day View accessibility demo structure; new Month View equivalent\n\n**Month View Keyboard Shortcuts:**\n\n| Shortcut | Action |\n|----------|--------|\n| Arrow keys | Navigate between cells |\n| Enter / Space | Select focused cell / enter event selection |\n| Home | First day of month |\n| End | Last day of month |\n| Page Up | Previous month |\n| Page Down | Next month |\n| Tab / Shift+Tab | Cycle events on cell |\n| R | Enter resize mode |\n| S / E | Switch resize edge |\n| M | Return to move mode |\n| Escape | Cancel operation |\n\n## Data Models\n\n### ThemePreset\n\n```dart\nenum ThemePreset { defaultPreset, compact, spacious, highContrast, minimal }\n```\n\n### MonthViewFeatureSettings\n\n```dart\nclass MonthViewFeatureSettings {\n  bool showNavigator;\n  bool enableSwipeNavigation;\n  MCalSwipeNavigationDirection swipeDirection;\n  int firstDayOfWeek;\n  bool showWeekNumbers;\n  int maxVisibleEventsPerDay;\n  bool enableDragToMove;\n  bool? enableDragToResize;\n  bool showDropTargetTiles;\n  bool showDropTargetOverlay;\n  bool dropTargetTilesAboveOverlay;\n  bool dragEdgeNavigationEnabled;\n  Duration dragEdgeNavigationDelay;\n  Duration dragLongPressDelay;\n  bool? enableAnimations;\n  Duration animationDuration;\n  Curve animationCurve;\n  bool enableKeyboardNavigation;\n  bool autoFocusOnCellTap;\n  bool enableBlackoutDays;\n  Set<int> blackoutWeekdays;\n}\n```\n\n### DayViewFeatureSettings\n\n```dart\nclass DayViewFeatureSettings {\n  int startHour;\n  int endHour;\n  Duration timeSlotDuration;\n  Duration gridlineInterval;\n  double? hourHeight;\n  bool showNavigator;\n  bool showCurrentTimeIndicator;\n  bool showWeekNumber;\n  int allDaySectionMaxRows;\n  Duration allDayToTimedDuration;\n  bool enableDragToMove;\n  bool? enableDragToResize;\n  bool showDropTargetPreview;\n  bool showDropTargetOverlay;\n  bool dropTargetTilesAboveOverlay;\n  bool dragEdgeNavigationEnabled;\n  Duration dragEdgeNavigationDelay;\n  Duration dragLongPressDelay;\n  bool snapToTimeSlots;\n  bool snapToOtherEvents;\n  bool snapToCurrentTime;\n  Duration snapRange;\n  bool? enableAnimations;\n  Duration animationDuration;\n  bool enableKeyboardNavigation;\n  bool autoFocusOnEventTap;\n  bool autoScrollToCurrentTime;\n  bool enableSpecialTimeRegions;\n  bool enableBlackoutTimes;\n}\n```\n\n### MonthThemeSettings / DayThemeSettings\n\nState classes holding all curated theme property values with `toThemeData()` methods that return configured `MCalThemeData` instances. Include `applyPreset(ThemePreset)` to load preset values.\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Missing localization key**\n   - **Handling**: Flutter's gen-l10n will catch missing keys at compile time. All 5 ARB files must be kept in sync.\n   - **User Impact**: Build failure with clear error message identifying the missing key.\n\n2. **Invalid control panel value**\n   - **Handling**: Sliders have min/max bounds; dropdowns have fixed options; toggles are boolean. No freeform input.\n   - **User Impact**: Cannot enter invalid values due to constrained inputs.\n\n3. **Stress test performance degradation**\n   - **Handling**: Event counts capped at 500. Performance overlay available for diagnosis.\n   - **User Impact**: App may slow down during stress test (expected behavior being measured).\n\n## Testing Strategy\n\n### Unit Testing\n\n- No new unit tests required for the example app (it is a showcase, not a library)\n- Existing package tests remain unchanged\n\n### Integration Testing\n\n- Verify the example app builds and runs: `cd example && flutter build apk --debug`\n- Verify `flutter analyze` passes with no errors\n- Verify all 5 ARB files are in sync (gen-l10n produces no errors)\n\n### End-to-End Testing\n\n- Manual testing: navigate all tabs for both Month and Day views\n- Verify control panel responsiveness at phone, tablet, and desktop widths\n- Verify all 5 languages display correctly (especially RTL for Arabic and Hebrew)\n- Verify gesture SnackBars fire for all handlers\n- Verify stress test metrics display and update\n- Verify accessibility tab keyboard shortcuts match actual behavior\n\n## Localization Strategy\n\n### Key Naming Convention\n\nAll new ARB keys follow a prefix convention for organization:\n\n| Prefix | Area |\n|--------|------|\n| `tab*` | Tab labels (e.g., `tabFeatures`, `tabTheme`, `tabStyles`, `tabStressTest`, `tabAccessibility`) |\n| `section*` | Control panel section headers (e.g., `sectionNavigation`, `sectionDragDrop`) |\n| `setting*` | Individual setting labels (e.g., `settingDragToMove`, `settingShowNavigator`) |\n| `style*` | Style names and descriptions (reuse existing where possible) |\n| `stress*` | Stress test labels (e.g., `stressEventCount`, `stressToggle`) |\n| `a11y*` | Accessibility content (reuse existing `accessibility*` keys where possible) |\n| `snackbar*` | SnackBar messages (e.g., `snackbarCellTap`, `snackbarEventDoubleTap`) |\n| `dialog*` | Dialog labels (e.g., `dialogEventTitle`, `dialogStartDate`) |\n| `preset*` | Theme preset names (e.g., `presetDefault`, `presetCompact`) |\n\n### Translation Approach\n\n- English (en) ARB is the source of truth\n- Spanish (es), French (fr), Arabic (ar), Hebrew (he) translations provided for all keys\n- RTL languages (ar, he) tested for layout correctness\n",
  "fileStats": {
    "size": 22106,
    "lines": 486,
    "lastModified": "2026-02-16T02:42:52.648Z"
  },
  "comments": []
}