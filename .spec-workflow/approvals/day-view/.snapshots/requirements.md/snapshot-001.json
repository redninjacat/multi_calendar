{
  "id": "snapshot_1771049147853_m0anvmhza",
  "approvalId": "approval_1771049147847_wvrg6pgvn",
  "approvalTitle": "Day View Requirements Document",
  "version": 1,
  "timestamp": "2026-02-14T06:05:47.853Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Day View\n\n## Introduction\n\nThis specification defines the implementation of `MCalDayView` - the second major calendar view widget for the multi_calendar Flutter package. MCalDayView provides a vertical timeline display of a single day's events, showing both all-day events in a dedicated header section and timed events positioned proportionally to their start/end times.\n\nThe day view complements the existing MCalMonthView by providing detailed time-of-day visibility, overlap handling for concurrent events, and precise time-based drag-and-drop interactions. It follows all established patterns from MCalMonthView for consistency, including extensive customization via builders, comprehensive theme support, full accessibility features, and RTL layout support.\n\nThis implementation addresses developer needs for:\n- **Detailed schedule viewing**: Hour-by-hour timeline with customizable time ranges\n- **Event overlap visualization**: Column-based layout for concurrent events (like Google Calendar)\n- **Time-based interactions**: Drag to change start times, resize to adjust duration, with time slot snapping\n- **Complete customization**: Builder callbacks for every visual element\n- **Accessibility**: Full keyboard navigation and screen reader support\n- **Multi-platform support**: Optimized for mobile with desktop scaling\n\n## Alignment with Product Vision\n\n**From product.md:**\n- **Modularity**: Day view is a separate widget (MCalDayView), allowing developers to use only what they need without monolithic dependencies\n- **Flexibility**: Supports any event storage backend through the existing delegation pattern via MCalEventController\n- **Standards Compliance**: Continues full RFC 5545 RRULE support for recurring events\n- **Developer Experience**: API patterns mirror MCalMonthView for easy adoption\n- **Customization First**: Extensive builder callbacks and theme properties\n- **Performance**: Efficient rendering with viewport-based calculations, maintains 60fps with 50+ events\n- **Accessibility First**: Complete keyboard navigation, screen reader semantic labels, reduced motion support\n- **International Ready**: RTL support, localization via intl package, DST-safe time calculations\n- **Mobile-First**: Touch-optimized with desktop enhancements (hover, precise resizing)\n\n**From tech.md:**\n- **Widget-based Architecture**: Stateful widget with controller pattern for state management\n- **Flutter SDK compatibility**: Works with Flutter >=1.17.0, Dart ^3.10.4\n- **Intl package integration**: Date/time formatting and localization\n- **DST-safe calculations**: All time arithmetic uses `DateTime(y, m, d, h, m)` constructor pattern\n- **Accessibility APIs**: Full `Semantics` widget integration\n- **ChangeNotifier pattern**: Reuses existing MCalDragHandler for drag/resize state\n\n## Requirements\n\n### Requirement 1: Time Legend Display\n\n**User Story:** As a calendar user, I want to see hour labels along the edge of the day view, so that I can quickly identify what time events occur without counting gridlines.\n\n#### Acceptance Criteria\n\n1. WHEN MCalDayView renders THEN it SHALL display a time legend column showing hour labels\n2. WHEN the locale is LTR (left-to-right) THEN the time legend SHALL be positioned on the left side\n3. WHEN the locale is RTL (right-to-left) THEN the time legend SHALL be positioned on the right side\n4. WHEN `startHour` parameter is set THEN the time legend SHALL begin at the specified hour (0-23)\n5. WHEN `endHour` parameter is set THEN the time legend SHALL end at the specified hour (0-23)\n6. IF `startHour` is not provided THEN it SHALL default to 0 (midnight)\n7. IF `endHour` is not provided THEN it SHALL default to 23 (11 PM)\n8. WHEN rendering hour labels THEN they SHALL be formatted according to the locale's time format (12-hour vs 24-hour)\n9. WHEN `timeLabelFormat` parameter is provided THEN hour labels SHALL be formatted using the specified format string\n10. WHEN `timeLabelBuilder` callback is provided THEN it SHALL override default formatting and use the custom builder\n11. WHEN the time legend is rendered THEN its width SHALL be configurable via `timeLegendWidth` theme property (default: 60dp)\n12. WHEN the time legend background is themed THEN it SHALL respect `timeLegendBackgroundColor` and `timeLegendTextStyle` properties\n\n### Requirement 2: Gridlines and Time Slots\n\n**User Story:** As a calendar user, I want to see horizontal lines at hour and half-hour intervals, so that I can visually estimate event times and align new events to time boundaries.\n\n#### Acceptance Criteria\n\n1. WHEN the timed events area renders THEN it SHALL display horizontal gridlines at each full hour\n2. WHEN `showHalfHourLines` is true (default) THEN gridlines SHALL also appear at 30-minute intervals\n3. WHEN hour gridlines render THEN they SHALL use `hourGridlineColor` theme property (default: outline with 0.2 alpha)\n4. WHEN half-hour gridlines render THEN they SHALL use `halfHourGridlineColor` theme property (default: outline with 0.1 alpha)\n5. WHEN half-hour gridlines render THEN they SHALL be visually lighter/thinner than hour gridlines\n6. WHEN `gridlineBuilder` callback is provided THEN it SHALL allow custom gridline rendering per hour/half-hour\n7. WHEN calculating gridline positions THEN they SHALL be positioned based on `hourHeight` (auto-calculated or configured)\n8. IF `hourHeight` is null THEN the system SHALL calculate it automatically as: `(viewport height - all-day section height) / (endHour - startHour + 1)`\n9. WHEN rendering the timed events area THEN the total height SHALL be: `hourHeight × (endHour - startHour + 1)`\n\n### Requirement 3: Day Header\n\n**User Story:** As a calendar user, I want to see which day I'm viewing at the top of the calendar, so that I maintain context while scrolling through time slots.\n\n#### Acceptance Criteria\n\n1. WHEN MCalDayView renders THEN it SHALL display a day header showing the current date\n2. WHEN in LTR mode THEN the day header SHALL be positioned at top-left of the events area\n3. WHEN in RTL mode THEN the day header SHALL be positioned at top-right of the events area\n4. WHEN the header displays by default THEN it SHALL show day-of-week and date number (e.g., \"FRI 13\")\n5. WHEN `dateFormat` parameter is provided THEN the header SHALL format the date using the specified format string\n6. WHEN `dayHeaderBuilder` callback is provided THEN it SHALL override default header rendering\n7. WHEN the user taps the day header THEN `onDayHeaderTap` callback SHALL be invoked with `MCalDayHeaderContext`\n8. WHEN the user long-presses the day header THEN `onDayHeaderLongPress` callback SHALL be invoked\n9. WHEN the day header is themed THEN it SHALL respect relevant theme properties from MCalThemeData\n\n### Requirement 4: All-Day Events Section\n\n**User Story:** As a calendar user, I want all-day events displayed in a dedicated section at the top, so that they don't clutter the hourly timeline and are immediately visible.\n\n#### Acceptance Criteria\n\n1. WHEN events with `isAllDay == true` exist for the displayed date THEN they SHALL render in the all-day section\n2. WHEN the all-day section renders THEN it SHALL be positioned below the day header and above the timed events area\n3. WHEN all-day events render THEN they SHALL be laid out horizontally (similar to month view multi-day tiles)\n4. WHEN `allDaySectionMaxRows` is set (default: 3) THEN the section SHALL display at most that many rows of events\n5. IF more all-day events exist than `allDaySectionMaxRows` THEN an overflow indicator SHALL be shown\n6. WHEN the overflow indicator is tapped THEN `onOverflowTap` callback SHALL be invoked\n7. WHEN `allDayEventTileBuilder` callback is provided THEN it SHALL be used to render all-day event tiles\n8. WHEN an all-day event is tapped THEN `onEventTap` callback SHALL be invoked with `MCalEventTapDetails`\n9. WHEN an all-day event is long-pressed THEN `onEventLongPress` callback SHALL be invoked\n10. WHEN all-day section height is auto-calculated THEN it SHALL be: `(number of visible rows) × (tile height + spacing)` with a maximum based on `allDaySectionMaxRows`\n11. IF `allDaySectionHeight` theme property is set THEN it SHALL override the auto-calculated height\n\n### Requirement 5: Timed Events Layout and Positioning\n\n**User Story:** As a calendar user, I want timed events positioned vertically according to their start and end times, with their height reflecting duration, so that I can quickly understand the schedule at a glance.\n\n#### Acceptance Criteria\n\n1. WHEN an event with `isAllDay == false` exists THEN it SHALL render in the timed events area\n2. WHEN calculating an event's vertical position THEN it SHALL use: `topOffset = ((event.start.hour - startHour) * 60 + event.start.minute) / 60.0 * hourHeight`\n3. WHEN calculating an event's height THEN it SHALL use: `height = (event.end - event.start).inMinutes / 60.0 * hourHeight`\n4. WHEN an event's calculated height is less than `timedEventMinHeight` (default: 20dp) THEN it SHALL be clamped to the minimum\n5. WHEN multiple events overlap in time THEN the system SHALL use an overlap detection algorithm to assign them to columns\n6. WHEN events are assigned to columns THEN they SHALL be rendered side-by-side with equal column widths\n7. WHEN rendering an event tile THEN it SHALL be positioned absolutely within the timed events stack using `Positioned` widget\n8. WHEN `timedEventTileBuilder` callback is provided THEN it SHALL be used to render timed event tiles\n9. WHEN `dayLayoutBuilder` callback is provided THEN it SHALL allow complete custom layout of overlapping events (similar to `weekLayoutBuilder` in month view)\n10. WHEN an event tile is tapped THEN `onEventTap` callback SHALL be invoked\n11. WHEN an event tile is long-pressed THEN `onEventLongPress` callback SHALL be invoked\n12. WHEN hovering over an event tile on platforms with hover support THEN `onHoverEvent` callback SHALL be invoked\n\n### Requirement 6: Overlap Detection Algorithm\n\n**User Story:** As a developer integrating the day view, I want the system to automatically detect overlapping events and lay them out in columns, so that all concurrent events are visible without manual layout calculations.\n\n#### Acceptance Criteria\n\n1. WHEN determining if two events overlap THEN they SHALL be considered overlapping IF: `event1.start < event2.end AND event2.start < event1.end`\n2. WHEN calculating layout THEN events SHALL first be sorted by start time, with ties broken by duration (longest first)\n3. WHEN assigning columns THEN the system SHALL iterate through sorted events and assign each to the first available column where it doesn't overlap existing events in that column\n4. WHEN calculating column widths THEN they SHALL be equal: `columnWidth = timedEventsAreaWidth / totalColumnsUsed`\n5. WHEN an event spans multiple columns (no conflicts) THEN it MAY expand to fill available adjacent empty columns\n6. WHEN `dayLayoutBuilder` is provided THEN it SHALL receive all events with their calculated layout assignments and MAY return a completely custom layout\n7. WHEN the default layout is used THEN it SHALL produce a Google Calendar-style column layout\n8. WHEN calculating layout THEN the algorithm SHALL complete in O(n²) time or better where n is the number of events\n\n### Requirement 7: Current Time Indicator\n\n**User Story:** As a calendar user, I want to see a line marking the current time, so that I can quickly identify \"now\" within the day's schedule.\n\n#### Acceptance Criteria\n\n1. WHEN the displayed date is today THEN a current time indicator SHALL be rendered\n2. WHEN the current time indicator renders THEN it SHALL be a horizontal line spanning the width of the timed events area\n3. WHEN in LTR mode THEN a circular dot SHALL appear on the left end of the indicator line\n4. WHEN in RTL mode THEN a circular dot SHALL appear on the right end of the indicator line\n5. WHEN calculating the indicator's vertical position THEN it SHALL use: `offset = ((now.hour - startHour) * 60 + now.minute) / 60.0 * hourHeight`\n6. WHEN time changes THEN the indicator position SHALL update automatically via `Timer.periodic` every minute\n7. WHEN `showCurrentTimeIndicator` is false THEN the indicator SHALL NOT render\n8. IF `showCurrentTimeIndicator` is not provided THEN it SHALL default to true\n9. WHEN the indicator is themed THEN it SHALL respect `currentTimeIndicatorColor`, `currentTimeIndicatorWidth`, and `currentTimeIndicatorDotRadius` theme properties\n10. WHEN `currentTimeIndicatorBuilder` callback is provided THEN it SHALL allow complete custom rendering of the indicator\n11. WHEN the widget is disposed THEN the timer SHALL be cancelled to prevent memory leaks\n\n### Requirement 8: Vertical Scrolling\n\n**User Story:** As a calendar user, I want to scroll vertically through the day's time range, so that I can view events outside the visible viewport and navigate to any time of day.\n\n#### Acceptance Criteria\n\n1. WHEN the timed events area height exceeds the viewport THEN the view SHALL be vertically scrollable\n2. WHEN `autoScrollToCurrentTime` is true (default) AND the displayed date is today THEN the view SHALL automatically scroll to show the current time on initial render\n3. WHEN auto-scrolling to current time THEN it SHALL position the current time indicator in the vertical center of the viewport (if possible)\n4. WHEN `scrollPhysics` parameter is provided THEN the scroll view SHALL use the specified physics\n5. IF `scrollPhysics` is not provided THEN it SHALL use default `ClampingScrollPhysics`\n6. WHEN scrolling occurs THEN `onScrollChanged` callback SHALL be invoked with scroll position details\n7. WHEN the controller method `scrollToTime(DateTime time)` is called THEN the view SHALL programmatically scroll to show the specified time\n8. WHEN the controller method `scrollToEvent(MCalCalendarEvent event)` is called THEN the view SHALL scroll to show the event\n9. WHEN scrolling near the top or bottom edge during a drag operation THEN it SHALL NOT trigger auto-navigation (edge navigation is horizontal-only)\n\n### Requirement 9: Day Navigator\n\n**User Story:** As a calendar user, I want navigation controls to move between days, so that I can quickly jump to yesterday, today, or tomorrow.\n\n#### Acceptance Criteria\n\n1. WHEN `showNavigator` is true THEN a navigator SHALL render at the top of the day view\n2. IF `showNavigator` is not provided THEN it SHALL default to false\n3. WHEN the navigator renders by default THEN it SHALL display: Previous button, date display, Today button, Next button\n4. WHEN Previous button is tapped THEN the view SHALL navigate to the previous day\n5. WHEN Next button is tapped THEN the view SHALL navigate to the next day\n6. WHEN Today button is tapped THEN the view SHALL navigate to today's date\n7. WHEN navigation occurs THEN `onDisplayDateChanged` callback SHALL be invoked with the new date\n8. WHEN `minDate` is set AND the displayed date equals minDate THEN Previous button SHALL be disabled\n9. WHEN `maxDate` is set AND the displayed date equals maxDate THEN Next button SHALL be disabled\n10. WHEN `navigatorBuilder` callback is provided THEN it SHALL allow complete custom navigator rendering\n11. WHEN the navigator builder is used THEN it SHALL receive `MCalNavigatorContext` with: `displayedDate`, `canGoPrevious`, `canGoNext`, navigation callbacks\n\n### Requirement 10: Drag-to-Move Time-Based\n\n**User Story:** As a calendar user, I want to long-press and drag an event vertically to change its start time, so that I can quickly reschedule without opening an editor.\n\n#### Acceptance Criteria\n\n1. WHEN `enableDragToMove` is true AND the user long-presses an event tile THEN a drag operation SHALL initiate\n2. WHEN a drag is initiated THEN the system SHALL use the existing `MCalDragHandler` to manage drag state\n3. WHEN dragging vertically THEN the event's proposed start time SHALL update based on pointer Y position\n4. WHEN calculating proposed start time from Y position THEN it SHALL use: `offsetToTime(yOffset, displayDate, startHour, hourHeight, timeSlotDuration)`\n5. WHEN `timeSlotDuration` is set (default: 15 minutes) THEN proposed times SHALL snap to time slot boundaries\n6. WHEN dragging THEN a drop target preview tile SHALL render at the proposed time position\n7. WHEN dragging THEN highlighted time slots SHALL show the proposed time range\n8. WHEN `onDragWillAccept` callback is provided THEN it SHALL be invoked to validate the proposed time range\n9. IF `onDragWillAccept` returns false THEN the drop target SHALL show invalid visual feedback\n10. WHEN the user releases the drag THEN `onEventDropped` callback SHALL be invoked with `MCalEventDroppedDetails`\n11. IF `onEventDropped` returns true (or is not provided) THEN the event SHALL update to the new time\n12. IF `onEventDropped` returns false THEN the event SHALL revert to its original time\n13. WHEN dragging an all-day event THEN it SHALL remain an all-day event (time-of-day changes not applicable)\n14. WHEN dragging a timed event across the all-day section boundary THEN it SHALL convert to/from all-day status\n15. WHEN dragging a recurring event occurrence THEN the controller SHALL create a `modified` exception with the updated event\n\n### Requirement 11: Drag-to-Move Cross-Day Navigation\n\n**User Story:** As a calendar user, I want to drag an event to the left or right edge to move it to the previous or next day, so that I can reschedule across days in one gesture.\n\n#### Acceptance Criteria\n\n1. WHEN `dragEdgeNavigationEnabled` is true (default) AND dragging horizontally near the left edge THEN the view SHALL navigate to the previous day after a delay\n2. WHEN dragging horizontally near the right edge THEN the view SHALL navigate to the next day after a delay\n3. WHEN edge navigation is triggered THEN the delay SHALL be configurable (default: matching month view's 1200ms)\n4. WHEN edge navigation occurs during drag THEN the drag gesture SHALL persist and continue on the new day\n5. WHEN edge proximity is calculated THEN the threshold SHALL be consistent with month view (10% of viewport width or 50px, whichever is larger)\n6. WHEN navigating at `minDate` boundary THEN backward navigation SHALL be prevented\n7. WHEN navigating at `maxDate` boundary THEN forward navigation SHALL be prevented\n8. WHEN navigation completes THEN the proposed drop time SHALL be recalculated for the new day at the same time-of-day\n9. WHEN edge navigation repeats (user holds near edge) THEN it SHALL use a self-repeating timer pattern (similar to month view)\n\n### Requirement 12: Drag-to-Resize Top and Bottom Edges\n\n**User Story:** As a calendar user, I want to drag the top or bottom edge of an event to change its start or end time, so that I can adjust event duration without opening an editor.\n\n#### Acceptance Criteria\n\n1. WHEN `enableDragToResize` is true AND the user drags the top edge of an event tile THEN the start time SHALL change\n2. WHEN the user drags the bottom edge of an event tile THEN the end time SHALL change\n3. WHEN resize handles render THEN they SHALL be visible on hover (desktop/web) or always visible (configurable)\n4. WHEN a resize handle is hovered THEN the cursor SHALL change to `SystemMouseCursors.resizeUpDown`\n5. WHEN resizing THEN the proposed new time SHALL snap to `timeSlotDuration` boundaries\n6. WHEN resizing would result in an event shorter than `timeSlotDuration` THEN the minimum duration SHALL be enforced (cannot shrink below 1 slot)\n7. WHEN resizing THEN a drop target preview SHALL show the proposed new event bounds\n8. WHEN `onResizeWillAccept` callback is provided THEN it SHALL be invoked to validate the proposed times\n9. IF `onResizeWillAccept` returns false THEN the preview SHALL show invalid visual feedback\n10. WHEN the user releases the resize THEN `onEventResized` callback SHALL be invoked with `MCalEventResizedDetails`\n11. IF `onEventResized` returns true (or is not provided) THEN the event SHALL update to the new times\n12. IF `onEventResized` returns false THEN the event SHALL revert to its original times\n13. WHEN resizing a recurring event occurrence THEN the controller SHALL create a `modified` exception with updated times\n14. WHEN `timeResizeHandleBuilder` callback is provided THEN it SHALL allow custom resize handle rendering\n15. WHEN all-day events are displayed THEN they SHALL NOT have resize handles (duration resize not applicable to all-day)\n\n### Requirement 13: Keyboard Navigation Day and Event Focus\n\n**User Story:** As a keyboard user, I want to navigate the calendar using arrow keys, so that I can use the day view without a mouse.\n\n#### Acceptance Criteria\n\n1. WHEN `enableKeyboardNavigation` is true (default) THEN the day view SHALL handle keyboard input\n2. WHEN Left Arrow is pressed THEN the view SHALL navigate to the previous day\n3. WHEN Right Arrow is pressed THEN the view SHALL navigate to the next day\n4. WHEN Up Arrow is pressed THEN focus SHALL move to the previous event in the day (by start time)\n5. WHEN Down Arrow is pressed THEN focus SHALL move to the next event in the day (by start time)\n6. WHEN Home key is pressed THEN the view SHALL navigate to today\n7. WHEN PageUp is pressed THEN the view SHALL navigate back 7 days\n8. WHEN PageDown is pressed THEN the view SHALL navigate forward 7 days\n9. WHEN Tab is pressed THEN focus SHALL move to the next focusable element (standard behavior)\n10. WHEN an event has focus THEN it SHALL have visual focus indication (themed via `focusedEventBorderColor` or similar)\n11. WHEN keyboard navigation is disabled THEN Escape key SHALL still be handled (for canceling drags)\n\n### Requirement 14: Keyboard Event Move Mode\n\n**User Story:** As a keyboard user, I want to move events using arrow keys, so that I have an accessible alternative to drag-and-drop.\n\n#### Acceptance Criteria\n\n1. WHEN an event is focused AND Enter or Space is pressed THEN the system SHALL enter keyboard event move mode\n2. WHEN in move mode THEN Up/Down arrows SHALL change the proposed start time by 1 time slot\n3. WHEN in move mode THEN Left/Right arrows SHALL change the proposed day by 1 day\n4. WHEN in move mode THEN the drop target preview SHALL show the proposed new position\n5. WHEN in move mode AND Enter is pressed THEN the move SHALL be confirmed via the `onEventDropped` callback\n6. WHEN in move mode AND Escape is pressed THEN the move SHALL be cancelled\n7. WHEN in move mode THEN `onDragWillAccept` validation SHALL apply\n8. WHEN confirming a keyboard move THEN the same logic as mouse-based drop SHALL be used\n9. WHEN in move mode THEN screen reader SHALL announce each proposed time change\n10. WHEN move is confirmed or cancelled THEN screen reader SHALL announce the result\n\n### Requirement 15: Keyboard Event Resize Mode\n\n**User Story:** As a keyboard user, I want to resize events using keyboard shortcuts, so that I have an accessible alternative to edge-drag resizing.\n\n#### Acceptance Criteria\n\n1. WHEN an event is selected in keyboard move mode AND R key is pressed THEN the system SHALL enter resize mode\n2. WHEN entering resize mode THEN the active edge SHALL default to the end edge (bottom)\n3. WHEN in resize mode AND S key is pressed THEN the active edge SHALL switch to the start edge (top)\n4. WHEN in resize mode AND E key is pressed THEN the active edge SHALL switch to the end edge (bottom)\n5. WHEN in resize mode THEN Up/Down arrows SHALL adjust the active edge by 1 time slot\n6. WHEN in resize mode THEN Left/Right arrows SHALL have no effect (day changes not applicable during resize)\n7. WHEN in resize mode AND Enter is pressed THEN the resize SHALL be confirmed via `onEventResized` callback\n8. WHEN in resize mode AND Escape is pressed THEN the resize SHALL be cancelled\n9. WHEN in resize mode AND M key is pressed THEN the system SHALL return to move mode (exit resize)\n10. WHEN in resize mode THEN minimum duration SHALL be enforced (cannot shrink below 1 time slot)\n11. WHEN in resize mode THEN `onResizeWillAccept` validation SHALL apply\n12. WHEN in resize mode THEN screen reader SHALL announce each edge adjustment\n13. WHEN resize is confirmed or cancelled THEN screen reader SHALL announce the result\n\n### Requirement 16: Empty Time Slot Interactions\n\n**User Story:** As a calendar user, I want to tap on empty time slots to create new events, so that I can quickly add events at specific times.\n\n#### Acceptance Criteria\n\n1. WHEN the user taps an empty area in the timed events section THEN `onTimeSlotTap` callback SHALL be invoked\n2. WHEN the callback is invoked THEN it SHALL receive `MCalTimeSlotContext` with: `date`, `time` (calculated from Y position), `isAllDayArea` (false)\n3. WHEN the user long-presses an empty time slot THEN `onTimeSlotLongPress` callback SHALL be invoked\n4. WHEN the user taps the time legend THEN `onTimeLabelTap` callback SHALL be invoked with the hour\n5. WHEN the user hovers over an empty time slot on hover-capable platforms THEN `onHoverTimeSlot` callback SHALL be invoked\n6. WHEN the user taps an empty area in the all-day section THEN `onTimeSlotTap` SHALL be invoked with `isAllDayArea` set to true\n\n### Requirement 17: Theme Integration and Customization\n\n**User Story:** As a developer, I want to customize all visual aspects of the day view via theme properties, so that I can match my app's design system.\n\n#### Acceptance Criteria\n\n1. WHEN MCalDayView renders THEN it SHALL apply theme properties from `MCalTheme.of(context)`\n2. WHEN theme properties are not found in `MCalTheme` THEN they SHALL fall back to `Theme.of(context).extension<MCalThemeData>()`\n3. IF no MCalThemeData extension exists THEN theme SHALL be generated via `MCalThemeData.fromTheme(Theme.of(context))`\n4. WHEN the following theme properties are set THEN they SHALL be applied:\n   - `timeLegendWidth`, `timeLegendTextStyle`, `timeLegendBackgroundColor`\n   - `hourGridlineColor`, `halfHourGridlineColor`\n   - `currentTimeIndicatorColor`, `currentTimeIndicatorWidth`, `currentTimeIndicatorDotRadius`\n   - `allDaySectionHeight`, `allDaySectionMaxRows`\n   - `hourHeight`, `timedEventMinHeight`, `timedEventBorderRadius`, `timedEventPadding`\n   - All existing event tile theme properties from month view\n5. WHEN day view specific properties are added to `MCalThemeData` THEN they SHALL follow the nullable pattern with sensible defaults\n6. WHEN light/dark mode changes THEN all theme properties SHALL adapt automatically via `ColorScheme`\n\n### Requirement 18: Builder Callback Customization\n\n**User Story:** As a developer, I want builder callbacks for all visual elements, so that I can completely customize the day view appearance without forking the package.\n\n#### Acceptance Criteria\n\n1. WHEN the following builder callbacks are provided THEN they SHALL override default rendering:\n   - `dayHeaderBuilder`: Custom day header rendering\n   - `timeLabelBuilder`: Custom time legend labels\n   - `allDayEventTileBuilder`: Custom all-day event tiles\n   - `timedEventTileBuilder`: Custom timed event tiles\n   - `currentTimeIndicatorBuilder`: Custom time indicator\n   - `gridlineBuilder`: Custom gridline rendering per hour\n   - `navigatorBuilder`: Custom navigator\n   - `dayLayoutBuilder`: Custom overlap layout algorithm\n   - `draggedTileBuilder`: Custom dragged tile feedback\n   - `dropTargetTileBuilder`: Custom drop preview tiles\n   - `timeResizeHandleBuilder`: Custom resize handles\n2. WHEN a builder callback is invoked THEN it SHALL receive a context object (e.g., `MCalTimeLabelContext`, `MCalTimedEventTileContext`) with all relevant data\n3. WHEN a builder returns a widget THEN it SHALL replace the default widget in that position\n4. WHEN a builder returns null (if allowed) THEN the default widget SHALL be used\n\n### Requirement 19: RTL (Right-to-Left) Layout Support\n\n**User Story:** As a user of RTL languages (Arabic, Hebrew), I want the day view to fully support RTL layout, so that the interface feels natural in my language.\n\n#### Acceptance Criteria\n\n1. WHEN the locale is RTL THEN the time legend SHALL be positioned on the right side\n2. WHEN the locale is RTL THEN the day header SHALL be positioned at top-right\n3. WHEN the locale is RTL THEN the current time indicator dot SHALL be on the right end of the line\n4. WHEN the locale is RTL THEN drag edge navigation directions SHALL be reversed (left edge = next day, right edge = previous day)\n5. WHEN the locale is RTL THEN all builder callbacks SHALL receive correct `isRTL` information in their context objects\n6. WHEN the locale is RTL THEN navigator buttons SHALL render in reversed order (Next, Today, Previous)\n7. WHEN testing in RTL mode THEN all interactions (tap, drag, resize, keyboard) SHALL work correctly\n\n## Non-Functional Requirements\n\n### Code Architecture and Modularity\n\n- **Single Responsibility**: Separate widgets for time legend, gridlines, all-day section, timed events, current time indicator, navigator - each with a single purpose\n- **Modular Design**: Overlap detection algorithm in dedicated utility class for testability\n- **Component Reuse**: Reuse `MCalDragHandler` from month view for all drag/resize operations\n- **Clean Interfaces**: Context objects (`MCalTimeSlotContext`, `MCalTimedEventTileContext`, etc.) provide clean contracts between view and builders\n- **State Management**: Controller pattern with `MCalEventController` for event data, widget state for UI concerns\n- **DST Safety**: All time calculations use `DateTime(y, m, d, h, m)` constructor pattern, never `Duration(days:)` or `Duration(hours:)` arithmetic\n- **Time Zone Neutrality**: Times are treated in local device time; time zone handling is out of scope (consistent with month view)\n\n### Performance\n\n- **Rendering**: Maintain 60fps during scrolling with 50+ events\n- **Overlap Detection**: Algorithm shall complete in O(n²) time or better where n = number of events\n- **Viewport Optimization**: Only render events visible in current scroll position (with small buffer)\n- **Time Calculation**: All time-to-offset and offset-to-time calculations shall use simple arithmetic (no expensive operations)\n- **Drag Updates**: Position updates during drag shall be debounced to 16ms intervals (60fps)\n- **Timer Efficiency**: Current time indicator timer shall fire once per minute, not continuously\n- **Memory**: View shall efficiently dispose timers, listeners, and resources when widget is disposed\n\n### Reliability\n\n- **Edge Cases**: Handle empty days, single event, 50+ overlapping events, midnight-spanning events, all-day conversion\n- **DST Boundaries**: Correctly handle dates near DST transitions using safe date arithmetic\n- **Boundary Enforcement**: Respect `minDate` and `maxDate` in all navigation and drag operations\n- **Error Recovery**: Gracefully handle invalid drag/resize operations by reverting to original state\n- **Controller Integration**: Handle controller updates (events added/removed/modified) and rebuild efficiently\n- **Recurring Events**: Correctly expand recurring events for displayed date, handle exceptions\n\n### Usability\n\n- **Touch Targets**: All interactive elements shall have minimum 44×44dp touch targets (iOS) or 48×48dp (Material)\n- **Visual Feedback**: All interactions (tap, drag, resize, hover) shall provide immediate visual feedback\n- **Drag Affordance**: Long-press delay (default: 200ms) shall feel natural, not too fast or too slow\n- **Snap Feedback**: Time slot snapping during drag/resize shall feel smooth, not jarring\n- **Scroll Inertia**: Vertical scrolling shall feel natural with platform-appropriate physics\n- **Loading States**: Display loading indicator when controller is fetching events\n- **Error States**: Display error message if controller reports loading failure\n- **Empty States**: Display helpful message when no events exist for the day\n\n### Accessibility\n\n- **Screen Reader**: All interactive elements shall have semantic labels\n- **Semantic Announcements**: Drag, resize, and navigation operations shall announce via `SemanticsService`\n- **Focus Management**: Keyboard focus shall be visually indicated and follow logical order\n- **Focus Trap Prevention**: Focus shall not get trapped in any part of the view\n- **Reduced Motion**: Respect `MediaQuery.disableAnimationsOf(context)` for users with motion sensitivity\n- **Color Contrast**: Default theme shall meet WCAG AA contrast ratios (4.5:1 for text)\n- **Keyboard Complete**: All mouse interactions shall have keyboard equivalents\n- **Touch Accommodations**: Support larger touch targets when accessibility features request it\n\n### Localization\n\n- **Date Formatting**: Use intl package for date formatting in day header\n- **Time Formatting**: Use locale-appropriate 12/24-hour format in time legend\n- **RTL Layouts**: Full RTL support as specified in Requirement 19\n- **Localized Strings**: All UI text (today button, overflow indicators) shall use `MCalLocalizations`\n- **Number Formatting**: Hour numbers shall be formatted per locale (e.g., Arabic numerals in Arabic locales)\n\n### Consistency with MCalMonthView\n\n- **API Patterns**: Parameter naming, callback signatures, builder patterns shall mirror month view\n- **Theme Structure**: Day view theme properties shall extend existing `MCalThemeData` consistently\n- **Drag Handler Integration**: Reuse same `MCalDragHandler` patterns for drag/resize state management\n- **Controller Integration**: Use same `MCalEventController` with same event loading patterns\n- **Context Objects**: Follow same pattern as `MCalDayCellContext`, `MCalEventTileContext` from month view\n- **Callback Details**: Follow same pattern as `MCalEventDroppedDetails`, `MCalEventResizedDetails` from month view\n- **Keyboard Navigation**: Key mappings and interaction patterns shall be consistent\n- **Documentation Style**: API docs shall follow same dartdoc patterns as month view\n",
  "fileStats": {
    "size": 33711,
    "lines": 449,
    "lastModified": "2026-02-14T06:05:38.898Z"
  },
  "comments": []
}