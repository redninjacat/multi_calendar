{
  "id": "snapshot_1770945178686_e0whq0eeu",
  "approvalId": "approval_1770944884357_eq3r7uxif",
  "approvalTitle": "Month View Polish - Tasks Document",
  "version": 2,
  "timestamp": "2026-02-13T01:12:58.686Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document: Month View Polish\n\n## Phase 1: Foundation (details classes, drag handler state, animation refactor)\n\n- [ ] 1. Add `MCalResizeEdge` enum and resize callback detail classes\n  - File: `lib/src/widgets/mcal_callback_details.dart`\n  - Create `MCalResizeEdge` enum with values: `start`, `end`\n  - Create `MCalResizeWillAcceptDetails` class with fields: `event`, `proposedStartDate`, `proposedEndDate`, `resizeEdge`\n  - Create `MCalEventResizedDetails` class with fields: `event`, `oldStartDate`, `oldEndDate`, `newStartDate`, `newEndDate`, `resizeEdge`, `isRecurring`, `seriesId`\n  - Follow the exact same immutable pattern as existing `MCalEventDroppedDetails` and `MCalDragWillAcceptDetails`\n  - Add full dartdoc with examples\n  - Purpose: Establish type-safe detail objects for resize callbacks\n  - _Leverage: Existing callback detail patterns in `lib/src/widgets/mcal_callback_details.dart` (e.g. `MCalEventDroppedDetails` at ~line 432, `MCalDragWillAcceptDetails` at ~line 467)_\n  - _Requirements: 1.15, 1.16_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Dart Developer specializing in data modeling | Task: Add `MCalResizeEdge` enum and two new detail classes (`MCalResizeWillAcceptDetails`, `MCalEventResizedDetails`) to `lib/src/widgets/mcal_callback_details.dart`. Follow the design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 3: Resize Callback Details\" exactly. Model them after the existing `MCalEventDroppedDetails` and `MCalDragWillAcceptDetails` in the same file. Add full dartdoc with usage examples. | Restrictions: Do NOT modify any existing classes. Append to end of file. Do NOT export from multi_calendar.dart yet (Task 6 handles that). | Success: `dart analyze` clean, new classes compile, follow existing patterns. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 2. Add resize state machine to `MCalDragHandler`\n  - File: `lib/src/widgets/mcal_drag_handler.dart`\n  - Add private resize state fields: `_isResizing`, `_resizingEvent`, `_resizeEdge`, `_resizeOriginalStart`, `_resizeOriginalEnd`\n  - Add public getters: `isResizing`, `resizingEvent`, `resizeEdge`\n  - Implement `startResize(MCalCalendarEvent event, MCalResizeEdge edge)` — sets resize state, stores original dates, notifies listeners\n  - Implement `updateResize({required DateTime proposedStart, required DateTime proposedEnd, required bool isValid, required List<MCalHighlightCellInfo> cells})` — updates shared proposed range fields and highlighted cells, notifies\n  - Implement `completeResize()` — returns `(DateTime, DateTime)?` tuple of proposed dates if valid, clears state\n  - Implement `cancelResize()` — clears all resize state, notifies\n  - Implement private `_clearResizeState()` helper\n  - Ensure mutual exclusivity: `startResize` asserts `!isDragging`, `startDrag` asserts `!isResizing`\n  - The shared fields `_proposedStartDate`, `_proposedEndDate`, `_isProposedDropValid`, `_highlightedCells` are reused by both drag and resize (mutually exclusive states)\n  - Purpose: Extend drag handler with resize lifecycle, reusing highlight infrastructure\n  - _Leverage: Existing drag state pattern in `lib/src/widgets/mcal_drag_handler.dart` (`startDrag`, `updateDrag`, `completeDrag`, `cancelDrag`). Design doc section \"Component 1: Resize State in MCalDragHandler\"._\n  - _Requirements: 1.7, 1.8, 1.9, 1.13, 1.14_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in state management | Task: Add resize state machine to `MCalDragHandler` in `lib/src/widgets/mcal_drag_handler.dart` following the design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 1\" exactly. Add private fields (`_isResizing`, `_resizingEvent`, `_resizeEdge`, `_resizeOriginalStart`, `_resizeOriginalEnd`), public getters, and methods (`startResize`, `updateResize`, `completeResize`, `cancelResize`, `_clearResizeState`). Reuse the shared `_proposedStartDate`/`_proposedEndDate`/`_isProposedDropValid`/`_highlightedCells` fields. Add assertions for mutual exclusivity with drag state. Import `MCalResizeEdge` from `mcal_callback_details.dart`. | Restrictions: Do NOT modify existing drag methods. Drag and resize are mutually exclusive. | Success: `dart analyze` clean, existing drag tests pass, resize methods work independently. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 3. Refactor `enableAnimations` from `bool` to `bool?` with reduced motion detection\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Change `final bool enableAnimations` to `final bool? enableAnimations` (line ~378)\n  - Change constructor default from `this.enableAnimations` with a value of `true` to `this.enableAnimations` with no default (null default) (line ~672)\n  - Update dartdoc to explain: `null` follows OS reduced motion preference, `true` forces on, `false` forces off\n  - Add private `bool _resolveAnimationsEnabled(BuildContext context)` method that checks `widget.enableAnimations` first, then falls back to `!MediaQuery.accessibilityFeaturesOf(context).reduceMotion`\n  - Replace all `widget.enableAnimations` usages (currently ~line 1059) with the resolved value\n  - Purpose: Automatically respect OS reduced motion while preserving developer override\n  - _Leverage: Existing `enableAnimations` usage pattern in `mcal_month_view.dart`. Design doc section \"Component 6: Refactored Animation Control\"._\n  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in accessibility | Task: Refactor `enableAnimations` from `bool` to `bool?` in `MCalMonthView` at `lib/src/widgets/mcal_month_view.dart`. Change the parameter type and default. Add `_resolveAnimationsEnabled(BuildContext context)` that checks explicit override first, then `MediaQuery.accessibilityFeaturesOf(context).reduceMotion`. Replace all `widget.enableAnimations` usages with the resolved value. Update dartdoc per design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 6\". | Restrictions: `true` and `false` must retain their exact previous behavior. `setDisplayDate(animate: false)` must still bypass all animation logic. Do NOT change the controller's `shouldAnimateNextChange` mechanism. | Success: `dart analyze` clean, existing animation tests pass with `enableAnimations: true`, reduced motion correctly disables animation when `enableAnimations` is null. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 2: Multi-Day Semantic Span Labels (independent, quick win)\n\n- [ ] 4. Add multi-day span localization keys\n  - File: `lib/src/utils/mcal_localization.dart`\n  - Add `formatMultiDaySpanLabel(int spanLength, int dayPosition, Locale locale)` method to `MCalLocalizations`\n  - Add localization template keys:\n    - English (`_enStrings`): `'multiDaySpanLabel': '{days}-day event, day {position} of {days}'`\n    - Spanish (`_esMxStrings`): `'multiDaySpanLabel': 'evento de {days} días, día {position} de {days}'`\n  - The method does `{days}` → `spanLength.toString()` and `{position}` → `dayPosition.toString()` replacement\n  - Purpose: Localizable span label infrastructure\n  - _Leverage: Existing `_enStrings`/`_esMxStrings` maps and `getLocalizedString` pattern in `lib/src/utils/mcal_localization.dart`_\n  - _Requirements: 5.5_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in i18n | Task: Add `formatMultiDaySpanLabel(int spanLength, int dayPosition, Locale locale)` to `MCalLocalizations` in `lib/src/utils/mcal_localization.dart`. Add template string keys `'multiDaySpanLabel'` to both `_enStrings` and `_esMxStrings`. The method gets the template via `getLocalizedString`, then replaces `{days}` and `{position}` placeholders. Follow design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 9\". | Restrictions: Do NOT modify existing localization keys. Append new keys. | Success: `dart analyze` clean, method returns correct formatted strings for both locales. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 5. Enrich `_EventTileWidget._getSemanticLabel` with multi-day span info\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Modify `_EventTileWidget._getSemanticLabel()` (currently at ~line 4773) to check `spanLength > 1`\n  - When multi-day, calculate day position using `daysBetween` (DST-safe) between event start and display date\n  - Append localized span label from `MCalLocalizations.formatMultiDaySpanLabel`\n  - Result format: `\"Team Offsite, All day, 3-day event, day 2 of 3\"`\n  - Single-day events remain unchanged\n  - Purpose: Screen reader users get full span context for multi-day events\n  - _Leverage: `_EventTileWidget` at ~line 4538 in `mcal_month_view.dart`. `daysBetween` from `lib/src/utils/date_utils.dart`. `MCalLocalizations` from Task 4._\n  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.6_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in accessibility | Task: Modify `_EventTileWidget._getSemanticLabel()` in `lib/src/widgets/mcal_month_view.dart` (~line 4773). When `spanLength > 1`, calculate `dayPosition` using DST-safe `daysBetween(eventStartDate, cellDate) + 1`, then append `MCalLocalizations().formatMultiDaySpanLabel(spanLength, dayPosition, locale)`. Single-day events (spanLength is 1 or less) keep current label. Follow design doc section \"Component 9\". | Restrictions: Do NOT change single-day event labels. Use `daysBetween` (not Duration arithmetic) for DST safety. | Success: `dart analyze` clean. Multi-day event semantic label includes span info. Single-day unchanged. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 3: Edge-Drag Resizing\n\n- [ ] 6. Add resize parameters to `MCalMonthView` and export new types\n  - Files: `lib/src/widgets/mcal_month_view.dart`, `lib/multi_calendar.dart`\n  - Add parameters to `MCalMonthView`:\n    - `bool? enableEventResize` (nullable, default null for auto-detect)\n    - `bool Function(BuildContext, MCalResizeWillAcceptDetails)? onResizeWillAccept`\n    - `bool Function(BuildContext, MCalEventResizedDetails)? onEventResized`\n  - Add these to the constructor with dartdoc\n  - Add private `bool _resolveEnableResize(BuildContext context)` method (platform detection: web enabled, desktop enabled, tablet enabled, phone disabled)\n  - Export `MCalResizeEdge`, `MCalResizeWillAcceptDetails`, `MCalEventResizedDetails` from `lib/multi_calendar.dart`\n  - Purpose: Public API surface for event resizing\n  - _Leverage: Existing drag-and-drop parameter pattern in `MCalMonthView` (~line 467-702). Design doc section \"Component 5: Platform-Aware Auto-Enable\"._\n  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.15, 1.16_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in widget API design | Task: Add three new parameters to `MCalMonthView` in `lib/src/widgets/mcal_month_view.dart`: `enableEventResize` (bool?), `onResizeWillAccept`, `onEventResized`. Add `_resolveEnableResize(BuildContext)` method per design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 5\". Export `MCalResizeEdge`, `MCalResizeWillAcceptDetails`, `MCalEventResizedDetails` from `lib/multi_calendar.dart`. | Restrictions: Do NOT implement resize interaction yet (Tasks 7-8). Just the parameter declarations, constructor entries, platform detection, and exports. | Success: `dart analyze` clean, new types importable from `package:multi_calendar/multi_calendar.dart`, existing tests pass. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 7. Implement `_ResizeHandle` widget and integrate into event tiles\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Create private `_ResizeHandle` StatelessWidget with:\n    - `edge` (MCalResizeEdge), `handleWidth` (double, default 8.0)\n    - `onResizeStart`, `onResizeUpdate` (double dx), `onResizeEnd`, `onResizeCancel` callbacks\n    - Renders a `Positioned` child at the leading or trailing edge (RTL-aware using `Directionality`)\n    - Uses `SystemMouseCursors.resizeColumn` on hover-capable platforms\n    - Visual: subtle vertical line/grip that appears on hover (desktop) or is always subtly visible (tablet)\n    - Wraps in `GestureDetector` with `onHorizontalDragStart`/`Update`/`End`/`Cancel`\n  - Modify event tile rendering in Layer 2 (the week layout builder's `eventTileBuilder`):\n    - When resize is enabled and the segment is start-of-span: add leading `_ResizeHandle`\n    - When resize is enabled and the segment is end-of-span: add trailing `_ResizeHandle`\n    - Single-day events: no resize handles (already minimum duration)\n    - Wrap the tile content and handles in a `Stack`\n  - Handles should have semantic labels: \"Resize start edge\" / \"Resize end edge\"\n  - Purpose: Visible, interactive resize affordance on event tile edges\n  - _Leverage: `_EventTileWidget` at ~line 4538. `MCalDraggableEventTile` pattern. Week layout context `eventTileBuilder`. Design doc section \"Component 2: Resize Handle Affordance\"._\n  - _Requirements: 1.7, 1.8, 1.11, 1.12, 1.23_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in gesture handling and UI | Task: Create `_ResizeHandle` widget and integrate it into event tiles in `lib/src/widgets/mcal_month_view.dart`. Follow design doc `.spec-workflow/specs/month-view-polish/design.md` section \"Component 2\" exactly. The handle is a thin (8dp) draggable zone on the start or end edge, RTL-aware via `Directionality`, with `GestureDetector` horizontal drag handlers. Add handles to the Layer 2 event tile builder: leading handle on start-of-span, trailing on end-of-span. No handles on single-day events. Use `SystemMouseCursors.resizeColumn`. Add semantic labels. | Restrictions: Do NOT implement the resize logic (date calculation, handler updates) yet — that is Task 8. Just wire up the visual handles and their gesture callbacks to placeholder functions. | Success: `dart analyze` clean, handles render on multi-day event edges, cursor changes on hover, handles are visually subtle. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 8. Implement resize interaction logic (gestures, preview, completion)\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Wire the `_ResizeHandle` callbacks to the drag handler:\n    - `onResizeStart`: call `dragHandler.startResize(event, edge)`\n    - `onResizeUpdate(dx)`: accumulate dx, calculate day delta using `(dxAccumulated / dayWidth).round()`, compute proposed start/end using DST-safe `DateTime(y, m, d + delta)`, enforce minimum 1 day, call `onResizeWillAccept` for validation, call `dragHandler.updateResize(...)` to show Layer 3/4 preview\n    - `onResizeEnd`: call `_handleResizeEnd()` — mirror `_handleDrop` flow: get final dates from `dragHandler.completeResize()`, call `onEventResized` callback, update controller\n    - `onResizeCancel`: call `dragHandler.cancelResize()`\n  - Implement `_handleResizeEnd()` method:\n    - Get proposed dates from `dragHandler.completeResize()`\n    - If null (invalid), return\n    - Calculate new start/end preserving time components using calendar-day arithmetic\n    - Build `MCalEventResizedDetails` with old/new dates, edge, isRecurring, seriesId\n    - Call `onEventResized` callback — if returns false, revert\n    - For non-recurring: `controller.addEvents([updatedEvent])`\n    - For recurring: `controller.modifyOccurrence(seriesId, originalDate, updatedEvent)`\n  - No cross-month edge navigation during resize\n  - Purpose: Complete resize interaction with validation, preview, and event mutation\n  - _Leverage: `_handleDrop` method (~line 2550) for the completion flow pattern. `daysBetween` for DST-safe delta. Design doc section \"Component 4: Resize Interaction in Month View\"._\n  - _Requirements: 1.7, 1.8, 1.9, 1.10, 1.13, 1.14, 1.15, 1.16, 1.17, 1.18, 1.19, 1.20, 1.21, 1.22_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in drag gestures and state management | Task: Wire `_ResizeHandle` callbacks to `MCalDragHandler` resize state in `lib/src/widgets/mcal_month_view.dart`. Implement the full resize interaction: gesture → day delta calculation (DST-safe) → minimum enforcement → validation → preview update → completion → event mutation. Implement `_handleResizeEnd()` mirroring `_handleDrop()` (~line 2550). For recurring events, use `controller.modifyOccurrence`. Follow design doc section \"Component 4\" exactly. | Restrictions: All date arithmetic MUST use `DateTime(y, m, d + delta)` form, NEVER `Duration(days:)`. No cross-month edge navigation. Minimum 1 day duration. | Success: `dart analyze` clean, edge-drag resizing works end-to-end: drag edge → preview shows → release → event updates. Recurring creates modified exception. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 4: Keyboard Event Moving\n\n- [ ] 9. Implement keyboard event selection and move mode\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Add private state fields: `_isKeyboardMoveMode`, `_keyboardMoveEvent`, `_keyboardMoveOriginalStart`, `_keyboardMoveOriginalEnd`, `_keyboardMoveEventIndex` (for multi-event cycling)\n  - Modify `_handleKeyEvent` (~line 1442):\n    - When Enter/Space is pressed on a focused cell AND `enableDragAndDrop` is true AND cell has events: enter event selection mode\n    - If one event: select immediately. If multiple: highlight first event, Tab/Shift+Tab cycles, Enter confirms selection\n    - Once selected: Arrow keys compute move delta (+1/-1 day, +/-7 days for Up/Down)\n    - Use `dragHandler.startDrag(event, originalDate)` on first arrow key (reusing drag state)\n    - Update `dragHandler` proposed range and highlighted cells at each step\n    - Call `onDragWillAccept` for validation\n    - Enter: call existing `_handleDrop` flow. Announce \"Moved {title} to {date}\"\n    - Escape: `dragHandler.cancelDrag()`, exit mode. Announce \"Move cancelled\"\n  - Add `SemanticsService.announce` calls at each step (selection, each move, confirm, cancel)\n  - Handle month boundary: when proposed date leaves visible month, navigate via `controller.setDisplayDate`\n  - Purpose: Accessible keyboard alternative to drag-and-drop\n  - _Leverage: Existing `_handleKeyEvent` at ~line 1442. `MCalDragHandler.startDrag/updateDrag/completeDrag`. `_handleDrop` at ~line 2550. Design doc section \"Component 7: Keyboard Event Moving\"._\n  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 3.10, 3.11, 3.12, 3.13, 3.14, 3.15_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in keyboard accessibility | Task: Implement keyboard event selection and move mode in `_handleKeyEvent` in `lib/src/widgets/mcal_month_view.dart`. Add state fields for keyboard-move mode. When Enter/Space on a cell with events and `enableDragAndDrop` is true: enter selection mode. Tab/Shift+Tab cycles events, Enter selects. Arrow keys move the event using `dragHandler.startDrag/updateDrag`. Enter confirms via `_handleDrop`, Escape cancels. Add `SemanticsService.announce` at each step. Handle month boundary navigation. Follow design doc section \"Component 7\" exactly. | Restrictions: Reuse existing `MCalDragHandler` and `_handleDrop` flow — do NOT duplicate the drop logic. Use DST-safe arithmetic for date calculations. | Success: `dart analyze` clean, keyboard move works end-to-end with announcements: select → arrow keys → preview shown → Enter confirms → event moves. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 5: Keyboard Event Resizing\n\n- [ ] 10. Implement keyboard resize mode (extends keyboard move)\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Add state fields: `_isKeyboardResizeMode`, `_keyboardResizeEdge` (MCalResizeEdge, default `.end`)\n  - Extend `_handleKeyEvent`:\n    - When an event is selected (keyboard-move mode active), pressing `R` enters resize mode:\n      - Set `_isKeyboardResizeMode` to `true`, call `dragHandler.startResize(event, MCalResizeEdge.end)`\n      - Announce: \"Resize mode. Adjusting end edge. Arrow keys to resize, S for start, E for end, Enter to confirm, Escape to cancel.\"\n    - `S` key: switch to start edge. `E` key: switch to end edge. Announce edge change.\n    - `M` key: cancel resize, return to move mode for same event\n    - Arrow keys: adjust active edge by delta (+1/-1 day, +/-7 days), enforce minimum 1 day, update `dragHandler.updateResize(...)`, call `onResizeWillAccept`, announce \"Resizing {title} end to {date}, {N} days\"\n    - Enter: call `_handleResizeEnd()` (from Task 8). Announce \"Resized {title} to {start} through {end}\"\n    - Escape: `dragHandler.cancelResize()`, exit resize mode. Announce \"Resize cancelled\"\n  - Purpose: Accessible keyboard alternative to edge-drag resizing\n  - _Leverage: Keyboard move mode from Task 9. `MCalDragHandler.startResize/updateResize/completeResize` from Task 2. `_handleResizeEnd` from Task 8. Design doc section \"Component 8: Keyboard Event Resizing\"._\n  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 4.10, 4.11, 4.12, 4.13, 4.14_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in keyboard accessibility | Task: Extend keyboard event handling in `lib/src/widgets/mcal_month_view.dart` to support resize mode. When event is selected and user presses `R`: enter resize mode using `dragHandler.startResize`. S/E switch edge, M returns to move mode, Arrow keys adjust edge date (DST-safe), Enter confirms via `_handleResizeEnd`, Escape cancels. Add `SemanticsService.announce` at each step. Follow design doc section \"Component 8\" exactly. | Restrictions: Reuse `MCalDragHandler` resize state machine and `_handleResizeEnd` from Task 8. Do NOT duplicate resize completion logic. Enforce minimum 1 day. | Success: `dart analyze` clean, keyboard resize works: R → arrow keys → preview → Enter confirms. S/E switch edges. M returns to move mode. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 6: Example App Integration\n\n- [ ] 11. Update Features Demo to showcase resize and keyboard interactions\n  - File: `example/lib/views/month_view/styles/features_demo_style.dart`\n  - Add toggle for `enableEventResize` in the control panel (both desktop and mobile layouts)\n  - Wire `onResizeWillAccept` and `onEventResized` callbacks with console output / snackbar feedback\n  - Ensure sample events include multi-day events that can be resized\n  - Add descriptive text/tooltip about keyboard shortcuts (R for resize, M for move, etc.)\n  - Purpose: Demonstrate resize and keyboard features to developers evaluating the package\n  - _Leverage: Existing drag-and-drop toggles and callbacks in `features_demo_style.dart`_\n  - _Requirements: 1.1-1.23, 3.1-3.15, 4.1-4.14_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in example apps | Task: Update `example/lib/views/month_view/styles/features_demo_style.dart` to showcase resize. Add a toggle for `enableEventResize` in the control panel. Wire `onResizeWillAccept` (reject weekends) and `onEventResized` (show snackbar with details). Ensure multi-day sample events exist. Add a help text about keyboard shortcuts (Enter to select, arrows to move, R for resize, S/E to switch edge, M for move mode). | Restrictions: Do NOT modify package code. All UI is in example/. | Success: Example app demonstrates resize with toggle, validation feedback, and keyboard shortcut help. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 7: Testing\n\n- [ ] 12. Unit tests for drag handler resize state machine\n  - File: `test/widgets/mcal_drag_handler_resize_test.dart` (NEW)\n  - Test `startResize`: sets state correctly, notifies listeners\n  - Test `updateResize`: updates proposed range and highlighted cells\n  - Test `completeResize`: returns proposed dates when valid, null when invalid\n  - Test `cancelResize`: clears all state, notifies\n  - Test mutual exclusivity: `startResize` while dragging → assertion error, and vice versa\n  - Test shared field reuse: after `updateResize`, `highlightedCells` and `proposedStartDate`/`End` are readable\n  - Purpose: Validate resize state machine independently\n  - _Leverage: Existing drag handler patterns. `flutter_test` package._\n  - _Requirements: 1.7-1.14_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer specializing in Dart unit testing | Task: Create `test/widgets/mcal_drag_handler_resize_test.dart`. Test groups: (1) startResize sets fields and notifies, (2) updateResize updates proposed range, (3) completeResize returns dates or null, (4) cancelResize clears state, (5) mutual exclusivity with drag state (assertion errors), (6) shared field reuse. | Restrictions: Use flutter_test. Test the handler in isolation. | Success: All tests pass. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n- [ ] 13. Widget tests for reduced motion, multi-day semantics, resize, and keyboard interactions\n  - File: `test/widgets/mcal_month_view_polish_test.dart` (NEW)\n  - Test groups:\n    - **Reduced motion**: `enableAnimations: null` + `reduceMotion: true` → verify `jumpToPage` used; `enableAnimations: true` + `reduceMotion: true` → verify `animateToPage` still used; `enableAnimations: false` → always `jumpToPage`\n    - **Multi-day semantics**: Multi-day event tile → verify semantic label includes span info (\"3-day event, day 2 of 3\"); single-day event → no span info\n    - **Edge-drag resize**: Simulate horizontal drag on resize handle → verify handler state → verify preview → verify callback with correct details; test minimum 1-day enforcement; test recurring event creates modified exception\n    - **Platform auto-detect**: `enableEventResize: null` on different platforms → verify correct resolution\n    - **Keyboard move**: Focus cell → Enter → Arrow → Enter → verify event moved; Escape → verify cancelled; Tab cycles events\n    - **Keyboard resize**: Select event → R → Arrow → Enter → verify resized; S/E switch edges; M returns to move; minimum duration enforced\n    - **RTL resize**: In RTL context, leading edge is right, trailing is left\n  - Purpose: Comprehensive widget-level verification of all new features\n  - _Leverage: Existing test patterns in `test/widgets/mcal_month_view_test.dart`. `flutter_test`, `WidgetTester`._\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer specializing in Flutter widget testing | Task: Create `test/widgets/mcal_month_view_polish_test.dart` with comprehensive widget tests for all new features. Groups: (1) Reduced motion — test enableAnimations null/true/false with MediaQuery reduceMotion. (2) Multi-day semantics — find Semantics widget on multi-day tile, verify label. (3) Edge-drag resize — simulate drag on handle, verify handler state and callbacks. (4) Platform auto-detect — mock platforms, verify enableEventResize resolution. (5) Keyboard move — send key events, verify event movement. (6) Keyboard resize — send R, arrows, Enter, verify resize. (7) RTL resize. | Restrictions: Use flutter_test. Create test events and controller in setUp. | Success: All tests pass. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n\n## Phase 8: Verification\n\n- [ ] 14. Run full test suite and analyzer\n  - Run `dart analyze` on the full project\n  - Run all tests (existing + new)\n  - Verify no regressions in existing 800+ tests\n  - Verify all new tests pass\n  - Verify example app compiles\n  - Purpose: Final verification that everything works together\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-polish, first run spec-workflow-guide to get the workflow guide then implement the task: Role: QA Engineer | Task: Run `dart analyze` on the full project and run the complete test suite. Verify: (1) dart analyze reports no errors, (2) all existing tests pass (800+), (3) all new tests pass, (4) example app compiles with `flutter build web` in example/. Report results. | Restrictions: Do NOT modify any source files. Verification only. | Success: Zero analyzer errors, all tests pass, example compiles. Mark task as [-] in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as [x]._\n",
  "fileStats": {
    "size": 30483,
    "lines": 222,
    "lastModified": "2026-02-13T01:10:55.266Z"
  },
  "comments": []
}