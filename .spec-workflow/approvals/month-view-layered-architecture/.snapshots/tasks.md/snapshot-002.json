{
  "id": "snapshot_1770164540723_3zmkbknkx",
  "approvalId": "approval_1770164460836_z7uhhxlag",
  "approvalTitle": "Month View Layered Architecture - Tasks",
  "version": 2,
  "timestamp": "2026-02-04T00:22:20.723Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Foundation - New Models and Context Objects\n\n- [ ] 1. Create MCalEventSegment and DateLabelPosition in new contexts file\n  - File: `lib/src/widgets/mcal_week_layout_contexts.dart`\n  - Create `MCalEventSegment` class with event, weekRowIndex, startDayInWeek, endDayInWeek, isFirstSegment, isLastSegment\n  - Create `DateLabelPosition` enum with 6 values (topLeft, topCenter, topRight, bottomLeft, bottomCenter, bottomRight)\n  - Add computed properties: spanDays, isSingleDay\n  - Purpose: Unified segment model for single-day and multi-day events\n  - _Leverage: Existing `MCalMultiDayRowSegment` pattern from `lib/src/widgets/mcal_multi_day_renderer.dart`_\n  - _Requirements: 5, 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer specializing in Flutter data models | Task: Create MCalEventSegment class and DateLabelPosition enum in new file mcal_week_layout_contexts.dart, following patterns from MCalMultiDayRowSegment. Include proper equality, hashCode, and toString implementations. | Restrictions: Do not modify existing files yet, follow existing naming conventions (MCal prefix), ensure immutable class design | Success: Classes compile without errors, follow existing patterns, include all required properties and computed getters. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 2. Create MCalWeekLayoutConfig in contexts file\n  - File: `lib/src/widgets/mcal_week_layout_contexts.dart` (continue from task 1)\n  - Create `MCalWeekLayoutConfig` class with all layout configuration values\n  - Add factory constructor `fromTheme(MCalThemeData theme)` to inherit values\n  - Include: tileHeight, tileVerticalSpacing, tileHorizontalSpacing, tileCornerRadius, tileBorderWidth, dateLabelHeight, dateLabelPosition, overflowIndicatorHeight\n  - Purpose: Configuration object that inherits from theme with override capability\n  - _Leverage: `MCalThemeData` patterns from `lib/src/styles/mcal_theme.dart`_\n  - _Requirements: 12, 13_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with Flutter theming expertise | Task: Create MCalWeekLayoutConfig class with factory fromTheme constructor that pulls values from MCalThemeData, using sensible defaults (tileHeight: 18.0, tileVerticalSpacing: 2.0, etc.) | Restrictions: Must be immutable, use null-coalescing for theme values with defaults, follow existing config patterns | Success: Config class compiles, fromTheme correctly inherits values, defaults match POC values. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 3. Create MCalOverflowIndicatorContext in contexts file\n  - File: `lib/src/widgets/mcal_week_layout_contexts.dart` (continue from task 2)\n  - Create `MCalOverflowIndicatorContext` class with date, hiddenEventCount, hiddenEvents, visibleEvents, width, height\n  - Purpose: Context object for overflow indicator builder\n  - _Leverage: Existing context patterns from `lib/src/widgets/mcal_month_view_contexts.dart`_\n  - _Requirements: 7, 9_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer specializing in Flutter builder patterns | Task: Create MCalOverflowIndicatorContext following existing context patterns (MCalDateLabelContext, MCalEventTileContext), including all required properties for overflow indicator rendering | Restrictions: Follow existing context naming and structure, immutable class design, include proper const constructor | Success: Context class follows existing patterns, contains all required properties for overflow building and tap handling. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 4. Create MCalWeekLayoutContext in contexts file\n  - File: `lib/src/widgets/mcal_week_layout_contexts.dart` (continue from task 3)\n  - Create `MCalWeekLayoutContext` class with segments, dates, columnWidths, rowHeight, weekRowIndex, currentMonth\n  - Add builder function properties: eventTileBuilder, dateLabelBuilder, overflowIndicatorBuilder\n  - Add config property for MCalWeekLayoutConfig\n  - Purpose: Main context object passed to weekLayoutBuilder\n  - _Leverage: Existing context patterns, MCalNavigatorContext as example with callbacks_\n  - _Requirements: 3, 10_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with Flutter builder pattern expertise | Task: Create MCalWeekLayoutContext containing all data needed by weekLayoutBuilder including pre-wrapped builder functions for event tiles, date labels, and overflow indicators | Restrictions: Builder function types must match expected signatures, follow existing context patterns, document all properties | Success: Context class contains all required data for week layout building, builder function types are correctly defined. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 2: Theme and Callback Updates\n\n- [ ] 5. Add new properties to MCalThemeData\n  - File: `lib/src/styles/mcal_theme.dart`\n  - Add: dateLabelHeight, dateLabelPosition (using DateLabelPosition enum), overflowIndicatorHeight, tileCornerRadius\n  - Update fromTheme() with sensible defaults\n  - Update copyWith() and lerp() methods\n  - Purpose: Enable theme-based configuration of new layout values\n  - _Leverage: Existing MCalThemeData property patterns_\n  - _Requirements: 12, 13_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer specializing in Flutter theming | Task: Add new nullable properties to MCalThemeData for dateLabelHeight, dateLabelPosition, overflowIndicatorHeight, tileCornerRadius. Update fromTheme with defaults (18.0, topLeft, 14.0, 3.0), copyWith, and lerp methods | Restrictions: Must maintain backward compatibility, follow existing property patterns exactly, ensure lerp handles enum correctly | Success: New properties added, fromTheme provides defaults, copyWith and lerp work correctly, existing tests still pass. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 6. Update MCalEventTileContext with segment info\n  - File: `lib/src/widgets/mcal_month_view_contexts.dart`\n  - Add segment property (MCalEventSegment) to MCalEventTileContext\n  - Add width and height properties for tile dimensions\n  - Update constructor to include new properties (with backwards-compatible defaults where possible)\n  - Purpose: Unified tile context for single-day and multi-day events\n  - _Leverage: Existing MCalEventTileContext structure_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with Flutter context pattern expertise | Task: Update MCalEventTileContext to include MCalEventSegment, width, and height properties, maintaining backward compatibility where possible | Restrictions: Import the new contexts file, preserve existing properties, add new properties as nullable or with defaults for compatibility | Success: Updated context includes segment info, existing code using old signature still compiles or has clear migration path. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 7. Add MCalOverflowTapDetails to callback details\n  - File: `lib/src/widgets/mcal_callback_details.dart`\n  - Create `MCalOverflowTapDetails` class with date, hiddenEvents, visibleEvents\n  - Purpose: Details object for onOverflowTap callback\n  - _Leverage: Existing callback details patterns (MCalCellTapDetails, etc.)_\n  - _Requirements: 7_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer specializing in Flutter callback patterns | Task: Create MCalOverflowTapDetails class following existing callback details patterns, containing date, hiddenEvents list, and visibleEvents list | Restrictions: Follow existing naming and structure exactly, immutable class with const constructor | Success: Details class follows existing patterns, can be used in onOverflowTap callback signature. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 3: Builder Wrapper Implementation\n\n- [ ] 8. Create MCalBuilderWrapper utility class\n  - File: `lib/src/widgets/mcal_builder_wrapper.dart` (new file)\n  - Implement static `wrapEventTileBuilder` method that wraps developer builder with GestureDetector and LongPressDraggable\n  - Implement static `wrapDateLabelBuilder` method (currently pass-through, extensible for future)\n  - Implement static `wrapOverflowIndicatorBuilder` method with tap handler\n  - Purpose: Separate visual customization from interaction handling\n  - _Leverage: Existing `MCalDraggableEventTile` wrapping patterns, GestureDetector usage in mcal_month_view.dart_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with Flutter gesture handling expertise | Task: Create MCalBuilderWrapper with static methods to wrap developer-provided builders with interaction handlers. wrapEventTileBuilder should add GestureDetector (onTap, onLongPress) and optionally LongPressDraggable. wrapOverflowIndicatorBuilder should add tap handler. | Restrictions: Must call developer's builder first to get visual widget, then wrap result with handlers, handle null developer builders by using default, maintain clean separation of concerns | Success: Wrapped builders include interaction handling, developer's visual customization is preserved, handlers invoke appropriate callbacks. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 4: Default Week Layout Builder\n\n- [ ] 9. Create MCalDefaultWeekLayoutBuilder with row assignment algorithm\n  - File: `lib/src/widgets/mcal_default_week_layout.dart` (new file)\n  - Create `MCalSegmentRowAssignment` class (segment + row index)\n  - Create `MCalOverflowInfo` class (hiddenCount, hiddenEvents, visibleEvents)\n  - Implement static `assignRows(List<MCalEventSegment>)` using greedy first-fit algorithm\n  - Implement static `calculateOverflow()` to compute per-day overflow info\n  - Purpose: Core layout algorithm matching POC behavior\n  - _Leverage: Algorithm from `MCalMultiDayRenderer.calculateWeekLayout()`, POC `_assignSegmentRows()` logic_\n  - _Requirements: 3, 9, 10_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with algorithm implementation expertise | Task: Create MCalDefaultWeekLayoutBuilder with greedy first-fit row assignment algorithm matching POC implementation. Port _assignSegmentRows logic and add overflow calculation that correctly counts hidden events per day column (not hidden rows) | Restrictions: Algorithm must handle multi-day events creating blank spaces, must match POC behavior exactly, O(n*m) complexity where n is events and m is max rows | Success: Row assignment produces same results as POC, overflow calculation correctly counts per-day hidden events. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 10. Add build method to MCalDefaultWeekLayoutBuilder\n  - File: `lib/src/widgets/mcal_default_week_layout.dart` (continue from task 9)\n  - Implement static `build(BuildContext, MCalWeekLayoutContext)` method\n  - Use Stack with Positioned widgets for date labels, event tiles, overflow indicators\n  - Apply conditional styling for multi-week event continuity (corners, borders, spacing)\n  - Purpose: Default layout matching POC visual output\n  - _Leverage: POC `_buildLayer2Events()`, `_buildEventTile()`, `_buildDateLabel()` logic_\n  - _Requirements: 3, 5, 6, 7_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with layout expertise | Task: Implement build method that creates a Stack with Positioned date labels, event tiles (via wrapped builder), and overflow indicators (via wrapped builder). Apply conditional corner radius, border, and spacing based on isFirstSegment/isLastSegment flags | Restrictions: Must use LayoutBuilder for constraints, must invoke the wrapped builders from context (not create widgets directly), must match POC visual output | Success: Default layout matches POC appearance, multi-week events have visual continuity, overflow indicators display correctly. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 5: MCalMultiDayRenderer Extension\n\n- [ ] 11. Extend MCalMultiDayRenderer to generate segments for ALL events\n  - File: `lib/src/widgets/mcal_multi_day_renderer.dart`\n  - Add new method `calculateAllEventSegments()` that generates MCalEventSegment for both single-day and multi-day events\n  - Single-day events get segment with spanDays=1, isFirstSegment=true, isLastSegment=true\n  - Maintain existing methods for backward compatibility during transition\n  - Purpose: Unified segment generation for new architecture\n  - _Leverage: Existing `calculateLayouts()` method as basis_\n  - _Requirements: 3, 5_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with event processing expertise | Task: Add calculateAllEventSegments method to MCalMultiDayRenderer that creates MCalEventSegment objects for ALL events (not just multi-day). Single-day events should have segments with spanDays=1 and both isFirstSegment and isLastSegment true | Restrictions: Keep existing methods working for now, sort all events consistently (multi-day first, then by start time), handle edge cases for events at month boundaries | Success: Method generates correct segments for all event types, maintains consistent ordering for layout algorithm. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 6: MCalMonthView Refactoring\n\n- [ ] 12. Add new parameters to MCalMonthView\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Add `weekLayoutBuilder` parameter with typedef\n  - Add `overflowIndicatorBuilder` parameter with typedef\n  - Remove `renderMultiDayEventsAsContiguous` parameter\n  - Remove `multiDayEventTileBuilder` parameter\n  - Update constructor documentation\n  - Purpose: New API surface for layered architecture\n  - _Leverage: Existing builder parameter patterns_\n  - _Requirements: 10, 11_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with widget API design expertise | Task: Add weekLayoutBuilder and overflowIndicatorBuilder parameters to MCalMonthView. Remove renderMultiDayEventsAsContiguous and multiDayEventTileBuilder parameters. Update parameter documentation. | Restrictions: Breaking changes are acceptable (unreleased package), follow existing builder parameter patterns, ensure proper nullability | Success: New parameters added with proper types and documentation, removed parameters cause compile errors in dependent code (expected). Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 13. Refactor _WeekRowWidget to use 3-layer Stack\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Refactor `_WeekRowWidget.build()` to return Stack with 3 layers\n  - Layer 1: Grid cells using dayCellBuilder (remove event rendering from cells)\n  - Layer 2: Events/labels using weekLayoutBuilder (or default)\n  - Layer 3: Drag ghost (conditional on isDragging)\n  - Use MCalBuilderWrapper to wrap builders before passing to weekLayoutBuilder\n  - Purpose: Core architectural change to layered rendering\n  - _Leverage: POC `_buildCalendarStack()` structure, MCalBuilderWrapper_\n  - _Requirements: 1, 2, 3, 4, 8_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Senior Flutter Developer with widget architecture expertise | Task: Refactor _WeekRowWidget to use 3-layer Stack architecture. Layer 1 renders grid cells only (no events). Layer 2 uses weekLayoutBuilder with wrapped builders. Layer 3 renders drag ghost during drag operations. | Restrictions: Must wrap developer builders using MCalBuilderWrapper before passing to weekLayoutBuilder, Layer 3 only renders when drag is active, preserve all existing interaction callbacks | Success: 3-layer Stack renders correctly, events appear in Layer 2 above grid, drag ghost appears in Layer 3, all interactions work. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 14. Update week number rendering to be outside layers\n  - File: `lib/src/widgets/mcal_month_view.dart`\n  - Move week number rendering outside the 3-layer Stack\n  - Position left (LTR) or right (RTL) based on text direction\n  - Use same height calculations as layers for vertical alignment\n  - Purpose: Week numbers aligned but independent of layer system\n  - _Leverage: Existing week number rendering, RTL detection patterns_\n  - _Requirements: 2_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with RTL layout expertise | Task: Move week number column outside the 3-layer Stack, positioned using Row with week numbers on left (LTR) or right (RTL). Ensure week row heights match between week numbers and Stack content. | Restrictions: Must detect RTL via Directionality.of(context), must maintain vertical alignment with week rows, preserve weekNumberBuilder callback | Success: Week numbers display correctly for both LTR and RTL, vertically aligned with corresponding week rows. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 7: Export and Integration\n\n- [ ] 15. Update multi_calendar.dart exports\n  - File: `lib/multi_calendar.dart`\n  - Export new public classes: MCalEventSegment, MCalWeekLayoutContext, MCalWeekLayoutConfig, MCalOverflowIndicatorContext, DateLabelPosition, MCalOverflowTapDetails\n  - Export MCalDefaultWeekLayoutBuilder for developers who want to extend it\n  - Purpose: Make new API publicly accessible\n  - _Leverage: Existing export patterns_\n  - _Requirements: 10, 11_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Dart Developer with package API design expertise | Task: Add exports for all new public classes to multi_calendar.dart, following existing export organization | Restrictions: Only export truly public API classes, maintain alphabetical ordering if present, ensure no circular dependencies | Success: All new public classes are importable via package:multi_calendar/multi_calendar.dart. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 8: Example App Updates\n\n- [ ] 16. Update minimal_style.dart to use new API\n  - File: `example/lib/views/month_view/styles/minimal_style.dart`\n  - Remove renderMultiDayEventsAsContiguous parameter\n  - Provide custom weekLayoutBuilder that renders dots for events\n  - Purpose: Demonstrate dots-style layout with new architecture\n  - _Leverage: POC patterns, new weekLayoutBuilder API_\n  - _Requirements: 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with example app expertise | Task: Update minimal_style.dart to use new API. Remove deprecated renderMultiDayEventsAsContiguous. Create custom weekLayoutBuilder that renders a single dot per day if events exist (like current behavior but via new architecture). | Restrictions: Must use weekLayoutBuilder pattern, maintain current visual appearance (dots), remove all usage of deprecated parameters | Success: Minimal style renders dots correctly using new architecture, no deprecated parameter usage. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 17. Update modern_style.dart to use new API\n  - File: `example/lib/views/month_view/styles/modern_style.dart`\n  - Remove renderMultiDayEventsAsContiguous parameter\n  - Provide custom weekLayoutBuilder for modern dots layout\n  - Purpose: Demonstrate modern styling with new architecture\n  - _Leverage: POC patterns, new weekLayoutBuilder API_\n  - _Requirements: 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with UI design expertise | Task: Update modern_style.dart to use new API with custom weekLayoutBuilder that maintains current modern dots appearance | Restrictions: Remove deprecated parameters, use new builder patterns, preserve visual appearance | Success: Modern style works with new architecture, visual appearance preserved. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 18. Create elongated pills style example\n  - File: `example/lib/views/month_view/styles/colorful_style.dart` (or new file)\n  - Remove renderMultiDayEventsAsContiguous parameter\n  - Create custom weekLayoutBuilder using eventTileBuilder that returns ~3px height pills without labels\n  - Demonstrate multi-day events as continuous elongated pills\n  - Purpose: Showcase elongated pill layout style per requirements\n  - _Leverage: POC patterns, new eventTileBuilder API with segment info_\n  - _Requirements: 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with creative UI expertise | Task: Create or update a style to use elongated pills (~3px height) without labels for events. Use eventTileBuilder that returns a thin colored bar, leveraging segment info for multi-day continuity (no rounded corners on continuation edges). | Restrictions: Pills should be ~3px tall, use event color, show visual continuity for multi-week events, no text labels | Success: Events display as thin elongated pills, multi-week events are visually continuous. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 19. Update features_demo_style.dart toggles\n  - File: `example/lib/views/month_view/styles/features_demo_style.dart`\n  - Remove renderMultiDayEventsAsContiguous toggle and related state\n  - Add toggles for new configuration options (dateLabelPosition, tileHeight, etc.)\n  - Purpose: Feature demo reflects new architecture capabilities\n  - _Leverage: Existing toggle patterns in features_demo_style.dart_\n  - _Requirements: 12, 13_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer with demo app expertise | Task: Update features_demo_style.dart to remove deprecated toggle for renderMultiDayEventsAsContiguous. Add controls for new themeable properties: dateLabelPosition dropdown, tileHeight slider. | Restrictions: Remove all references to deprecated parameters, add new controls following existing UI patterns | Success: Demo has controls for new config options, no deprecated parameter usage. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 20. Update remaining example styles\n  - Files: `example/lib/views/month_view/styles/classic_style.dart`, `example/lib/views/month_view/styles/compact_style.dart`\n  - Remove any usage of deprecated parameters\n  - Ensure all example styles compile and work with new API\n  - Purpose: Complete migration of example app\n  - _Requirements: 11, 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Flutter Developer | Task: Update classic_style.dart, compact_style.dart and any other example styles to remove deprecated parameters and work with new API | Restrictions: Must compile without errors, preserve intended visual appearance where possible | Success: All example styles compile and run correctly with new API. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 9: Testing\n\n- [ ] 21. Create unit tests for new context classes\n  - File: `test/widgets/mcal_week_layout_contexts_test.dart` (new file)\n  - Test MCalEventSegment (creation, computed properties, equality)\n  - Test MCalWeekLayoutConfig (fromTheme, defaults)\n  - Test DateLabelPosition enum values\n  - Purpose: Ensure model reliability\n  - _Leverage: Existing test patterns from test/models/_\n  - _Requirements: 5, 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer with Flutter testing expertise | Task: Create unit tests for MCalEventSegment, MCalWeekLayoutConfig, and DateLabelPosition covering construction, computed properties, equality, and theme inheritance | Restrictions: Follow existing test patterns, use flutter_test framework, ensure good coverage | Success: All new classes have comprehensive tests, edge cases covered. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 22. Create unit tests for MCalDefaultWeekLayoutBuilder\n  - File: `test/widgets/mcal_default_week_layout_test.dart` (new file)\n  - Test assignRows with various event combinations\n  - Test calculateOverflow with multi-day events creating blank spaces\n  - Test edge cases (empty events, single event, full week)\n  - Purpose: Ensure layout algorithm correctness\n  - _Leverage: Existing MCalMultiDayRenderer tests_\n  - _Requirements: 9, 10_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer with algorithm testing expertise | Task: Create unit tests for MCalDefaultWeekLayoutBuilder focusing on assignRows algorithm and calculateOverflow. Test various scenarios: overlapping events, multi-week events, overflow edge cases | Restrictions: Test algorithm logic in isolation, mock event data, verify row assignments match expected output | Success: Algorithm tests cover all scenarios, overflow calculation correctly handles blank spaces. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 23. Update existing MCalMonthView tests\n  - File: `test/widgets/mcal_month_view_test.dart`\n  - Remove tests for renderMultiDayEventsAsContiguous\n  - Add tests for weekLayoutBuilder and overflowIndicatorBuilder\n  - Add tests for 3-layer Stack structure\n  - Purpose: Ensure widget tests reflect new architecture\n  - _Leverage: Existing widget test patterns_\n  - _Requirements: 1, 3, 4_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer with Flutter widget testing expertise | Task: Update mcal_month_view_test.dart to remove tests for deprecated parameters. Add tests verifying 3-layer Stack structure, weekLayoutBuilder invocation, and builder wrapping behavior | Restrictions: Remove all tests using deprecated parameters, add meaningful tests for new architecture, maintain existing test coverage for unchanged features | Success: Tests pass, deprecated parameter tests removed, new architecture tests added. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 24. Update integration tests\n  - File: `test/integration/mcal_month_view_integration_test.dart`\n  - Remove references to deprecated parameters\n  - Add integration tests for complete event flow with new architecture\n  - Purpose: Ensure end-to-end functionality\n  - _Leverage: Existing integration test patterns_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer with integration testing expertise | Task: Update integration tests to remove deprecated parameter usage. Add tests for complete event rendering flow through Layer 2, drag-and-drop through Layer 3, and overflow indicator interactions | Restrictions: Must test real user scenarios, ensure drag-and-drop integration works with new layers | Success: Integration tests pass, cover new architecture flow, no deprecated parameter usage. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n## Phase 10: Documentation and Cleanup\n\n- [ ] 25. Update CHANGELOG.md\n  - File: `CHANGELOG.md`\n  - Document breaking changes (removed parameters)\n  - Document new features (weekLayoutBuilder, overflowIndicatorBuilder, layered architecture)\n  - Provide migration guidance\n  - Purpose: Communicate changes to developers\n  - _Requirements: 11_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Technical Writer | Task: Update CHANGELOG.md with breaking changes section listing removed parameters (renderMultiDayEventsAsContiguous, multiDayEventTileBuilder), new features section (weekLayoutBuilder, 3-layer architecture, overflowIndicatorBuilder), and migration guidance | Restrictions: Follow existing changelog format, be specific about breaking changes, provide clear migration steps | Success: Changelog clearly documents all changes and helps developers migrate. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 26. Update README.md\n  - File: `README.md`\n  - Update API documentation for new builders\n  - Remove references to deprecated parameters\n  - Add examples of custom weekLayoutBuilder usage\n  - Purpose: Package documentation reflects new architecture\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Technical Writer with Flutter documentation expertise | Task: Update README.md to document new weekLayoutBuilder pattern, overflowIndicatorBuilder, and layered architecture. Remove all references to deprecated parameters. Add usage examples. | Restrictions: Keep documentation concise but complete, update code examples to reflect new API | Success: README accurately describes new architecture and API, no deprecated parameter references. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 27. Remove deprecated code paths\n  - Files: `lib/src/widgets/mcal_month_view.dart`, `lib/src/widgets/mcal_multi_day_tile.dart`\n  - Remove any remaining code for renderMultiDayEventsAsContiguous=false path\n  - Remove multiDayEventTileBuilder handling code\n  - Clean up unused imports and methods\n  - Purpose: Code cleanup and simplification\n  - _Requirements: 11_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: Senior Dart Developer | Task: Remove all code related to deprecated parameters. Clean up unused methods, imports, and conditional code paths that were for the old architecture | Restrictions: Ensure no dead code remains, verify all tests still pass after cleanup | Success: Codebase is clean with no deprecated code paths, all tests pass. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n\n- [ ] 28. Final verification and example app testing\n  - Files: All example app files\n  - Run example app and verify all tabs work correctly\n  - Verify POC tab still functions as reference\n  - Test on both mobile and web\n  - Purpose: Final validation of implementation\n  - _Requirements: 12_\n  - _Prompt: Implement the task for spec month-view-layered-architecture, first run spec-workflow-guide to get the workflow guide then implement the task: | Role: QA Engineer | Task: Run comprehensive manual testing of example app. Verify all month view tabs render correctly. Test event interactions (tap, long-press, drag-drop). Verify both light and dark themes. Test on Chrome web and iOS/Android simulator. | Restrictions: Must test all tabs including Layout POC, verify no visual regressions | Success: All example tabs work correctly, interactions function properly, no visual regressions from current behavior. Mark task in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark complete._\n",
  "fileStats": {
    "size": 35121,
    "lines": 292,
    "lastModified": "2026-02-04T00:21:05.996Z"
  },
  "comments": []
}