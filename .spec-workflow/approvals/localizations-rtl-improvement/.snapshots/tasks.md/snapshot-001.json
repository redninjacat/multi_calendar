{
  "id": "snapshot_1771218651980_aaznyddvh",
  "approvalId": "approval_1771218651971_r0axhbik8",
  "approvalTitle": "Tasks: Localizations & RTL Improvement",
  "version": 1,
  "timestamp": "2026-02-16T05:10:51.980Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n- [ ] 1. Rename wrapper class and update l10n.yaml\n  - Rename: `lib/src/utils/mcal_localization.dart` → `lib/src/utils/mcal_date_format_utils.dart`\n  - Rename class: `MCalLocalizations` → `MCalDateFormatUtils`\n  - Remove `getLocalizedString()` method and `_lookup()` helper\n  - Remove `formatMultiDaySpanLabel()` old signature; add new signature taking `MCalLocalizations l10n` parameter\n  - Add static helpers: `weekdayName(MCalLocalizations l10n, int dayOfWeek)`, `weekdayShortName(MCalLocalizations l10n, int dayOfWeek)`, `monthName(MCalLocalizations l10n, int month)`\n  - Update `l10n.yaml`: add `synthetic-package: false`\n  - Purpose: Eliminate name collision, remove fragile string-key lookup, prepare index-based accessors for typed localization\n  - _Leverage: `lib/src/utils/mcal_localization.dart` (current wrapper), `lib/l10n/mcal_localizations.dart` (generated class)_\n  - _Requirements: REQ-1, REQ-2.4_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in localization architecture | Task: (1) Rename `lib/src/utils/mcal_localization.dart` to `lib/src/utils/mcal_date_format_utils.dart`. (2) Rename the class from `MCalLocalizations` to `MCalDateFormatUtils`. (3) Remove the `getLocalizedString(String key, Locale locale)` method and the `_lookup()` helper entirely. (4) Remove the import alias `import '../../l10n/mcal_localizations.dart' as l10n;` and replace with `import '../../l10n/mcal_localizations.dart';` (needed for the new static helpers). (5) Update `formatMultiDaySpanLabel` to take `MCalLocalizations l10n` instead of doing internal lookup — it should call `l10n.multiDaySpanLabel(spanLength.toString(), dayPosition.toString())`. (6) Add three static helpers: `weekdayName(MCalLocalizations l10n, int dayOfWeek)` returns the full weekday name from l10n (0=Sunday via l10n.daySunday, 1=Monday via l10n.dayMonday, etc.); `weekdayShortName(MCalLocalizations l10n, int dayOfWeek)` returns short name (0=l10n.daySundayShort, etc.); `monthName(MCalLocalizations l10n, int month)` returns month name (1=l10n.monthJanuary, etc.). (7) Keep `formatDate`, `formatTime`, `formatMonthYear`, `formatFullDateWithDayName`, `isRTL`, `supportedLocales`, `defaultLocale`, `_getEffectiveLocale`, `_localeToString`. (8) Update `l10n.yaml` at project root: add `synthetic-package: false`. | Restrictions: Do NOT modify the generated `lib/l10n/mcal_localizations.dart` or any ARB files yet. Do NOT modify any widget files yet — they will break temporarily until task 3. Keep the file under 250 lines. | _Leverage: `lib/src/utils/mcal_localization.dart`, `lib/l10n/mcal_localizations.dart` | _Requirements: REQ-1, REQ-2.4 | Success: New file compiles. Old file deleted. `MCalDateFormatUtils` has all formatting methods plus 3 new static helpers. `getLocalizedString` is gone. `l10n.yaml` has `synthetic-package: false`. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 2. Add announcement keys to package ARB files\n  - Modify: `lib/l10n/app_en.arb`, `app_es.arb`, `app_es_MX.arb`, `app_fr.arb`, `app_ar.arb`, `app_he.arb`\n  - Add ~17 new parameterized localization keys for screen reader announcements\n  - Run `flutter gen-l10n` to regenerate `MCalLocalizations`\n  - Purpose: Provide localized strings for all SemanticsService announcements currently hardcoded in English\n  - _Leverage: Design document Component 2 (new keys table), existing ARB files_\n  - _Requirements: REQ-4_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: i18n Engineer specializing in Flutter localization and accessibility | Task: Add 17 new keys to ALL 6 package ARB files. The keys and English values are: `announcementResizeCancelled`=\"Resize cancelled\", `announcementMoveCancelled`=\"Move cancelled for {title}\" (param: title), `announcementEventSelectionCancelled`=\"Event selection cancelled\", `announcementEventsHighlighted`=\"{count} events. {title} highlighted. Tab to cycle, Enter to confirm.\" (params: count, title), `announcementEventSelected`=\"Selected {title}. Arrow keys to move, Enter to confirm, Escape to cancel.\" (param: title), `announcementEventCycled`=\"{title}. {index} of {total}.\" (params: title, index, total), `announcementMovingEvent`=\"Moving {title} to {date}\" (params: title, date), `announcementResizeModeEntered`=\"Resize mode. Adjusting end edge. Arrow keys to resize, S for start, E for end, M for move mode, Enter to confirm.\", `announcementResizingStartEdge`=\"Resizing start edge\", `announcementResizingEndEdge`=\"Resizing end edge\", `announcementMoveMode`=\"Move mode\", `announcementMoveInvalidTarget`=\"Move cancelled. Invalid target.\", `announcementEventMoved`=\"Moved {title} to {date}\" (params: title, date), `announcementResizingProgress`=\"Resizing {title} {edge} to {date}, {days} days\" (params: title, edge, date, days), `announcementResizeInvalid`=\"Resize cancelled. Invalid resize.\", `announcementEventResized`=\"Resized {title} to {start} through {end}\" (params: title, start, end). For parameterized strings, add `@keyName` metadata with `placeholders` in the English template file. Provide accurate translations for Spanish (es), Mexican Spanish (es_MX), French (fr), Arabic (ar), and Hebrew (he). After editing all files, run `flutter gen-l10n` at the project root to regenerate the generated class. | Restrictions: Do NOT modify any Dart files besides the generated output. Ensure valid JSON in all ARB files. Keep existing keys unchanged. RTL languages (ar, he) must use proper RTL text. | _Leverage: Design document Component 2, existing ARB files | _Requirements: REQ-4 | Success: All 6 ARB files have the 17 new keys. `flutter gen-l10n` succeeds. The generated `MCalLocalizations` class has typed getters/methods for all new keys. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 3. Update package exports and fix import references\n  - Modify: `lib/multi_calendar.dart`\n  - Update all internal imports from `mcal_localization.dart` to `mcal_date_format_utils.dart`\n  - Export the generated `MCalLocalizations` class from `lib/l10n/mcal_localizations.dart`\n  - Purpose: Clean up exports so consuming apps get the generated class as `MCalLocalizations` and the utility as `MCalDateFormatUtils`\n  - _Leverage: `lib/multi_calendar.dart`, Design document Component 6_\n  - _Requirements: REQ-11_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in package API design | Task: (1) In `lib/multi_calendar.dart`, replace `export 'src/utils/mcal_localization.dart'` with `export 'src/utils/mcal_date_format_utils.dart'`. (2) Add `export 'l10n/mcal_localizations.dart'` to export the generated `MCalLocalizations` class (which provides `.of(context)`, `.delegate`, `.supportedLocales`, `.localizationsDelegates`). (3) Search all files in `lib/src/` for any import of `mcal_localization.dart` and update to `mcal_date_format_utils.dart`. The main files that import it are `mcal_month_view.dart` and `mcal_day_view.dart` — update their imports. Also update the class name references from `MCalLocalizations()` to `MCalDateFormatUtils()` in those files AND add import of the generated class `import '../../l10n/mcal_localizations.dart';` (aliased if needed to avoid confusion, e.g., `import '../../l10n/mcal_localizations.dart' as gen_l10n;`). Note: The widget files will still have broken `getLocalizedString` calls — that's fixed in tasks 4 and 5. Just fix the imports and class instantiation names for now. | Restrictions: Do NOT change any method call logic yet — only fix imports and class instantiation names. The code may have temporary compile errors from missing `getLocalizedString` calls — those are fixed in tasks 4-5. | _Leverage: `lib/multi_calendar.dart`, `lib/src/widgets/mcal_month_view.dart`, `lib/src/widgets/mcal_day_view.dart` | _Requirements: REQ-11 | Success: `lib/multi_calendar.dart` exports both `MCalLocalizations` (gen-l10n) and `MCalDateFormatUtils`. All internal imports updated. No references to old file name remain. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 4. Refactor MCalMonthView localization and fix RTL keyboard navigation\n  - Modify: `lib/src/widgets/mcal_month_view.dart`\n  - Replace all `getLocalizedString()` calls with `MCalLocalizations.of(context)` typed getters\n  - Replace all `localizations.isRTL(locale)` with `Directionality.of(context) == TextDirection.rtl` in widget build methods\n  - Fix `_announceMonthChange`: use `Directionality.of(context)` instead of hardcoded `TextDirection.ltr`\n  - Localize all hardcoded SemanticsService announcement strings using new ARB keys\n  - Fix keyboard navigation RTL: reverse arrowLeft/arrowRight in `_handleKeyEvent`, `_handleKeyboardMoveModeKey`, `_handleKeyboardResizeModeKey`\n  - Use `MCalDateFormatUtils.weekdayShortName()` and `.monthName()` for dynamic name lookups\n  - Purpose: Complete the Month View migration to standard localization and fix all RTL keyboard bugs\n  - _Leverage: `lib/src/widgets/mcal_month_view.dart`, Design document Components 3, new ARB keys from task 2_\n  - _Requirements: REQ-2, REQ-4, REQ-6, REQ-7, REQ-10_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in accessibility, localization, and RTL support | Task: Refactor `lib/src/widgets/mcal_month_view.dart` with these changes: (1) LOCALIZATION: Replace all `final localizations = MCalLocalizations()` (now `MCalDateFormatUtils()`) instantiations that are used for `getLocalizedString` calls. Instead, obtain `final l10n = MCalLocalizations.of(context)` at the start of build methods or where context is available. Replace each `localizations.getLocalizedString('key', locale)` with the typed getter: `l10n.today`, `l10n.calendar`, `l10n.focused`, `l10n.selected`, `l10n.event`, `l10n.events`, `l10n.doubleTapToSelect`, `l10n.dropTargetPrefix`, `l10n.dropTargetValid`, `l10n.dropTargetInvalid`, `l10n.dropTargetDateRangeTo`, `l10n.previousMonth`, `l10n.nextMonth`, `l10n.allDay`. For weekday headers, use `MCalDateFormatUtils.weekdayShortName(l10n, dayIndex)`. For month names in navigator, use `MCalDateFormatUtils.monthName(l10n, month)`. Keep `MCalDateFormatUtils()` for `formatDate`, `formatTime`, `formatMonthYear`, `formatFullDateWithDayName` calls. (2) RTL DETECTION: In widget build methods that currently use `localizations.isRTL(resolvedLocale)`, replace with `Directionality.of(context) == TextDirection.rtl`. Keep `MCalDateFormatUtils().isRTL(locale)` ONLY in the navigator and weekday header widgets that are standalone and take a `locale` parameter (these build their own Directionality wrapper). (3) ANNOUNCEMENTS: Fix `_announceMonthChange` ~line 1373: replace `TextDirection.ltr` with `Directionality.of(context)`. Localize ALL hardcoded English strings in SemanticsService calls using the new ARB keys from task 2. Examples: replace `'Resize cancelled'` with `l10n.announcementResizeCancelled`, replace `'Move cancelled for $title'` with `l10n.announcementMoveCancelled(title)`, replace `'Moving ${moveEvent.title} to $dateStr'` with `l10n.announcementMovingEvent(moveEvent.title, dateStr)`, etc. Ensure all `SemanticsService.sendAnnouncement` calls use `Directionality.of(context)` for the text direction parameter. (4) RTL KEYBOARD: In `_handleKeyEvent` ~line 1823: add `final isRTL = Directionality.of(context) == TextDirection.rtl; final rtlMult = isRTL ? -1 : 1;` and change arrowLeft to `focusedDate.day - 1 * rtlMult` (i.e., `day + (-1 * rtlMult)`) and arrowRight to `focusedDate.day + 1 * rtlMult` (i.e., `day + (1 * rtlMult)`). In `_handleKeyboardMoveModeKey` ~line 2159: change `arrowRight dayDelta = 1` to `dayDelta = 1 * rtlMult` and `arrowLeft dayDelta = -1` to `dayDelta = -1 * rtlMult`. In `_handleKeyboardResizeModeKey` ~line 2556: same pattern for arrowLeft/arrowRight delta. Up/Down remain unchanged. | Restrictions: Do NOT change any public API. Keep the `locale` parameter functional for formatting. Do NOT modify other files. This file is large (~7800 lines) — make precise, targeted changes. Test that the file compiles after changes. | _Leverage: `lib/src/widgets/mcal_month_view.dart`, Design document Component 3 | _Requirements: REQ-2, REQ-4, REQ-6, REQ-7, REQ-10 | Success: Zero `getLocalizedString` calls remain in the file. All SemanticsService announcements are localized. All announcement text directions use `Directionality.of(context)`. Arrow keys reverse in RTL for cell nav, move mode, and resize mode. File compiles. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 5. Refactor MCalDayView localization and fix RTL keyboard navigation\n  - Modify: `lib/src/widgets/mcal_day_view.dart`\n  - Replace all `getLocalizedString()` calls with `MCalLocalizations.of(context)` typed getters\n  - Replace `localizations.isRTL(locale)` with `Directionality.of(context) == TextDirection.rtl` in build methods\n  - Localize any hardcoded SemanticsService announcement strings\n  - Fix keyboard navigation RTL: reverse arrowLeft/arrowRight in normal key handler and keyboard move mode\n  - Purpose: Complete the Day View migration to standard localization and fix all RTL keyboard bugs\n  - _Leverage: `lib/src/widgets/mcal_day_view.dart`, Design document Component 4_\n  - _Requirements: REQ-2, REQ-8, REQ-9, REQ-10_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in accessibility, localization, and RTL support | Task: Refactor `lib/src/widgets/mcal_day_view.dart` with these changes: (1) LOCALIZATION: Replace all `final localizations = MCalDateFormatUtils()` used for `getLocalizedString` calls. Instead, obtain `final l10n = MCalLocalizations.of(context)` where context is available. Replace each `getLocalizedString('key', locale)` call: `l10n.scheduleFor(dateStr)`, `l10n.doubleTapToCreateEvent`, `l10n.dropTargetPrefix`, `l10n.dropTargetValid`/`l10n.dropTargetInvalid`, `l10n.previousDay`, `l10n.nextDay`, `l10n.today`, `l10n.currentTime(formattedTime)`, `l10n.timeGrid`. Keep `MCalDateFormatUtils()` for `formatDate`, `formatTime`, `isRTL` in the navigator widget. (2) RTL DETECTION: In build methods, replace `localizations.isRTL(locale)` with `Directionality.of(context) == TextDirection.rtl`. Keep `isRTL(locale)` in the navigator and current time indicator widgets that take locale parameter and build their own layout. (3) RTL KEYBOARD: In the normal key event handler ~line 1545-1553: where `arrowLeft` calls `_handleNavigatePrevious()` and `arrowRight` calls `_handleNavigateNext()`, add RTL check: `final isRTL = Directionality.of(context) == TextDirection.rtl;` then `if ((event.logicalKey == LogicalKeyboardKey.arrowLeft && !isRTL) || (event.logicalKey == LogicalKeyboardKey.arrowRight && isRTL)) { _handleNavigatePrevious(); } else { _handleNavigateNext(); }`. In keyboard move mode ~line 1596-1600: change `arrowLeft: _keyboardMoveByDays(-1)` and `arrowRight: _keyboardMoveByDays(1)` to apply RTL multiplier: `final rtlMult = isRTL ? -1 : 1;` then `arrowLeft: _keyboardMoveByDays(-1 * rtlMult)`, `arrowRight: _keyboardMoveByDays(1 * rtlMult)`. Context for `Directionality.of(context)` is available since these are methods on the State class. | Restrictions: Do NOT change any public API. Keep the `locale` parameter functional for formatting. Do NOT modify other files. Make precise, targeted changes. | _Leverage: `lib/src/widgets/mcal_day_view.dart`, Design document Component 4 | _Requirements: REQ-2, REQ-8, REQ-9, REQ-10 | Success: Zero `getLocalizedString` calls remain in the file. RTL arrow keys reversed for day navigation and keyboard move. File compiles. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 6. Wire package delegate in example app and localize app title\n  - Modify: `example/lib/main.dart`\n  - Add `MCalLocalizations.delegate` to `localizationsDelegates`\n  - Localize the app title using `onGenerateTitle`\n  - Purpose: Demonstrate correct delegate wiring pattern and complete app-level localization\n  - _Leverage: `example/lib/main.dart`, Design document Component 7_\n  - _Requirements: REQ-3, REQ-12.6_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Modify `example/lib/main.dart`: (1) Add import for multi_calendar package: `import 'package:multi_calendar/multi_calendar.dart';`. (2) Update `localizationsDelegates` to include the package delegate: `localizationsDelegates: [...AppLocalizations.localizationsDelegates, MCalLocalizations.delegate],`. (3) Replace the hardcoded `title: 'Multi Calendar Examples'` with `onGenerateTitle: (context) => AppLocalizations.of(context)?.appTitle ?? 'Multi Calendar Examples',`. | Restrictions: Keep the file minimal. Do not change theme, locale, or navigation logic. | _Leverage: `example/lib/main.dart` | _Requirements: REQ-3, REQ-12.6 | Success: App runs with MCalLocalizations.delegate wired. App title is localized. Package widgets can use `MCalLocalizations.of(context)` without errors. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 7. Fix example app hardcoded strings — Month View tabs\n  - Modify: `example/lib/views/month_view/tabs/month_features_tab.dart`\n  - Modify: `example/lib/views/month_view/tabs/month_accessibility_tab.dart`\n  - Replace all hardcoded English strings with `AppLocalizations.of(context)!` lookups\n  - Purpose: Complete localization of the Month View Features tab control panel labels, SnackBar messages, and the entire Accessibility tab content\n  - _Leverage: `example/lib/l10n/app_en.arb` (existing 424 keys), Design document Component 8a, 8b, 8c_\n  - _Requirements: REQ-12.1, REQ-12.2, REQ-12.3, REQ-12.5_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in i18n | Task: Fix two files. (1) `month_features_tab.dart`: Replace ALL hardcoded section headers ('Navigation', 'Display', 'Drag & Drop', 'Resize', 'Animation', 'Keyboard', 'Blackout Days') with `AppLocalizations.of(context)!` lookups using existing keys (sectionNavigation, sectionDisplay, sectionDragAndDrop, sectionResize, sectionAnimation, sectionKeyboard, sectionBlackoutDays). Replace ALL setting labels ('Show Navigator', 'Enable Swipe Navigation', 'Swipe Direction', 'Horizontal', 'Vertical', 'First Day of Week', etc.) with existing setting* keys. Replace ALL SnackBar messages ('Cell tapped: ...', 'Event dropped: ...', etc.) with existing snackbar* parameterized keys. Replace dropdown option labels ('Monday', 'Sunday', etc.) with existing day* keys. Replace 'Ease In Out', 'Linear', etc. with value* keys. (2) `month_accessibility_tab.dart`: Replace ALL hardcoded keyboard shortcut labels and descriptions with existing accessibility* keys. Replace all screen reader guide content, accessibility checklist items, navigation flow descriptions with existing keys. Replace section headers ('Keyboard Shortcuts', 'Screen Reader Guide', 'High Contrast Mode', 'Accessibility Checklist', 'Keyboard Navigation Flow') with existing keys. Replace 'Enable High Contrast' label. Check the existing 424 ARB keys first — most should already exist. If any key is missing, note it for task 10. | Restrictions: Use `AppLocalizations.of(context)!` (non-null assertion). Do NOT add new ARB keys in this task — just note any missing ones. Keep each file under 500 lines. | _Leverage: `example/lib/l10n/app_en.arb`, existing accessibility* and section* and setting* keys | _Requirements: REQ-12.1, REQ-12.2, REQ-12.3, REQ-12.5 | Success: Zero hardcoded English user-facing strings in both files. All text comes from AppLocalizations. Files compile (assuming ARB keys exist). Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 8. Fix example app hardcoded strings — Day View tabs and styles\n  - Modify: `example/lib/views/day_view/tabs/day_features_tab.dart`\n  - Modify: `example/lib/views/day_view/tabs/day_theme_tab.dart`\n  - Modify: `example/lib/views/day_view/tabs/day_stress_test_tab.dart`\n  - Modify: `example/lib/views/day_view/styles/day_classic_style.dart`\n  - Modify: `example/lib/views/day_view/styles/day_modern_style.dart`\n  - Modify: `example/lib/views/day_view/styles/day_minimal_style.dart`\n  - Modify: `example/lib/views/day_view/styles/day_colorful_style.dart`\n  - Replace all hardcoded English strings with `AppLocalizations.of(context)!` lookups\n  - Purpose: Complete localization of Day View tabs and style widgets\n  - _Leverage: `example/lib/l10n/app_en.arb` (existing 424 keys), Design document Component 8a, 8b_\n  - _Requirements: REQ-12.1, REQ-12.2, REQ-12.3_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in i18n | Task: Fix 7 files. (1) `day_features_tab.dart`: Replace hardcoded time region labels ('Lunch Break', 'After Hours (blocked)') and any remaining SnackBar messages ('Moved: ...', 'Resized: ...') with AppLocalizations lookups. (2) `day_theme_tab.dart`: Remove the null-check fallback pattern — instead of `l10n?.settingName ?? 'Hardcoded Fallback'`, use `AppLocalizations.of(context)!.settingName` directly. Replace ALL fallback strings in the preset label section and the theme setting sections. (3) `day_stress_test_tab.dart`: Replace inline sample event titles ('Morning Meeting', 'Lunch Break') with localized strings or accept them as mock data with a documenting comment. (4) `day_classic_style.dart`, `day_modern_style.dart`, `day_minimal_style.dart`, `day_colorful_style.dart`: Replace hardcoded SnackBar messages for event moved/resized ('Moved: ... to ...', 'Resized: ... to ... min') with AppLocalizations parameterized lookups. Note any missing ARB keys for task 10. | Restrictions: Use `AppLocalizations.of(context)!` directly. Do NOT add new ARB keys — note missing ones. | _Leverage: `example/lib/l10n/app_en.arb`, existing keys | _Requirements: REQ-12.1, REQ-12.2, REQ-12.3 | Success: Zero hardcoded English user-facing strings in all 7 files (excluding intentional mock data). All text comes from AppLocalizations. Files compile. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 9. Fix example app hardcoded strings — Month View styles\n  - Modify: `example/lib/views/month_view/styles/month_classic_style.dart`\n  - Modify: `example/lib/views/month_view/styles/month_modern_style.dart`\n  - Replace hardcoded \"Prev\", \"Next\", \"Today\" with localized strings\n  - Purpose: Complete localization of Month View style widgets\n  - _Leverage: `example/lib/l10n/app_en.arb`, Design document Component 8d_\n  - _Requirements: REQ-12.4_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Fix 2 files. (1) `month_classic_style.dart`: Replace hardcoded 'Prev' and 'Next' button labels with `AppLocalizations.of(context)!` lookups — use existing keys if available (e.g., `buttonPrevious`, `buttonNext`) or note them for task 10. (2) `month_modern_style.dart`: Replace hardcoded 'Today' tooltip with localized string. You can also use `MCalLocalizations.of(context).today` since the package delegate is now wired. | Restrictions: Minimal changes. Do NOT restructure the style widgets. | _Leverage: `example/lib/l10n/app_en.arb` | _Requirements: REQ-12.4 | Success: No hardcoded 'Prev', 'Next', or 'Today' strings in these files. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 10. Add any missing ARB keys and regenerate\n  - Modify: `example/lib/l10n/app_en.arb`, `app_es.arb`, `app_fr.arb`, `app_ar.arb`, `app_he.arb`\n  - Add any ARB keys that were identified as missing during tasks 7-9\n  - Run `flutter gen-l10n` in example/ to regenerate AppLocalizations\n  - Purpose: Ensure all localization key references have corresponding ARB entries with translations\n  - _Leverage: Notes from tasks 7-9, existing ARB files_\n  - _Requirements: REQ-12.7_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: i18n Engineer | Task: (1) Review all files modified in tasks 7-9 and identify every `AppLocalizations.of(context)!.keyName` reference. (2) Cross-reference against `example/lib/l10n/app_en.arb` to find any missing keys. (3) Add missing keys to ALL 5 example ARB files with proper translations (en, es, fr, ar, he). (4) Run `cd example && flutter gen-l10n` to regenerate. (5) Run `cd example && flutter analyze` to verify no missing key errors. | Restrictions: Do NOT modify Dart source files. Only modify ARB files. Translations must be accurate. | _Leverage: Tasks 7-9 output, existing ARB files | _Requirements: REQ-12.7 | Success: `flutter gen-l10n` succeeds. `flutter analyze` reports no errors related to missing localization keys. All 5 ARB files have matching key sets. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 11. Align locale support between package and example app\n  - Decide: Remove `es_MX` from package OR add `es_MX` to example app\n  - Modify affected ARB files and l10n config\n  - Purpose: Ensure package and example app support the same set of locales\n  - _Leverage: Design document Component 9_\n  - _Requirements: REQ-5_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Align locale support. The design recommends removing `es_MX` from the package since the example app doesn't have it and Mexican Spanish adds maintenance burden at v0.0.1. (1) Delete `lib/l10n/app_es_MX.arb`. (2) Run `flutter gen-l10n` at project root to regenerate without es_MX. (3) Update `MCalDateFormatUtils.supportedLocales` to remove `Locale('es', 'MX')`. (4) Verify both package and example app now support: en, es, fr, ar, he (5 locales each). Alternatively, if the maintainer prefers to keep es_MX, create `example/lib/l10n/app_es_MX.arb` instead with all 424+ keys translated to Mexican Spanish. | Restrictions: Only modify ARB files and the utility class's supportedLocales list. Run gen-l10n after changes. | _Leverage: Design document Component 9 | _Requirements: REQ-5 | Success: Package and example app have identical supported locale sets. `flutter gen-l10n` succeeds for both. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 12. Update tests\n  - Modify: `test/utils/localization_test.dart`\n  - Add: RTL keyboard navigation tests for Month View and Day View\n  - Update existing localization tests to use `of(context)` pattern\n  - Purpose: Verify the refactored localization and RTL keyboard behavior\n  - _Leverage: Existing test files, Design document Testing Strategy_\n  - _Requirements: REQ-6, REQ-7, REQ-8, REQ-9_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: (1) Update `test/utils/localization_test.dart`: rename references from `MCalLocalizations` to `MCalDateFormatUtils`. Add tests for `weekdayName()`, `weekdayShortName()`, `monthName()` static helpers. Keep existing `formatDate`, `formatTime`, `isRTL` tests but update class name. (2) Add RTL keyboard tests. For Month View: create a test widget wrapped in `Directionality(textDirection: TextDirection.rtl)` with `MCalLocalizations.delegate` wired, create a `MCalMonthView` with `enableKeyboardNavigation: true`, simulate `LogicalKeyboardKey.arrowLeft` and verify the focused date advances +1 day (not -1). Simulate `arrowRight` and verify -1 day. Verify `arrowUp`/`arrowDown` are unchanged. For Day View: similar setup, verify `arrowLeft` navigates to next day and `arrowRight` to previous day in RTL. (3) Add LTR regression tests confirming existing direction behavior is preserved. Use `MCalLocalizations.localizationsDelegates` to wire delegates in test widget builders. | Restrictions: Follow existing test patterns. Use `flutter_test` widgets. Ensure tests are independent. | _Leverage: Existing test files in `test/`, `test/widgets/mcal_month_view_test.dart`, `test/widgets/mcal_day_view_test.dart` | _Requirements: REQ-6, REQ-7, REQ-8, REQ-9 | Success: All new tests pass. All existing tests pass (updated for renamed class). RTL arrow reversal is verified for both views. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 13. Update steering documents\n  - Modify: `.spec-workflow/steering/tech.md`\n  - Modify: `.spec-workflow/steering/structure.md`\n  - Update localization sections to reflect the new `of(context)` pattern and `MCalDateFormatUtils`\n  - Purpose: Keep steering documents accurate for future specs\n  - _Leverage: Design document Component 10_\n  - _Requirements: REQ-13_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Update two steering documents. (1) `tech.md`: In the Key Dependencies section, update the Localization bullet to describe the new standard pattern. Replace references to `getLocalizedString(key, locale)` with `MCalLocalizations.of(context).propertyName`. Rename `MCalLocalizations` wrapper references to `MCalDateFormatUtils`. Note that consuming apps must add `MCalLocalizations.delegate` to their localizationsDelegates. Update the \"Usage pattern\" to say widgets use `MCalLocalizations.of(context)` — they do NOT instantiate directly. Update Application Architecture to say widgets use standard `of(context)` localization. Note that RTL detection uses `Directionality.of(context)` as primary mechanism. (2) `structure.md`: In the Utilities section, rename `MCalLocalizations` wrapper to `MCalDateFormatUtils`. Remove mention of `getLocalizedString`. Update the file path from `mcal_localization.dart` to `mcal_date_format_utils.dart`. Update External Integration Points localization description. Update Localization Notes to reflect standard `of(context)` pattern for the package. | Restrictions: Do NOT change content unrelated to localization/RTL. Keep document formatting consistent. | _Leverage: `.spec-workflow/steering/tech.md`, `.spec-workflow/steering/structure.md` | _Requirements: REQ-13 | Success: Both documents accurately describe the new localization architecture. No references to `getLocalizedString` or the old wrapper class name remain. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n\n- [ ] 14. Build verification and final fixes\n  - Run `flutter gen-l10n` at project root and in example/\n  - Run `flutter analyze` at project root and in example/\n  - Run `flutter build apk --debug` in example/\n  - Grep for `getLocalizedString` across all lib/src/ files — verify zero results\n  - Grep for remaining hardcoded English in new example app files\n  - Fix any compilation errors, analyzer warnings, or missing imports\n  - Run `flutter test` at project root\n  - Purpose: Ensure everything compiles, analyzes clean, tests pass, and no regressions\n  - _Leverage: All files from tasks 1-13_\n  - _Requirements: All (verification)_\n  - _Prompt: Implement the task for spec localizations-rtl-improvement, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Senior Flutter Developer specializing in build verification | Task: Run comprehensive verification: (1) `flutter gen-l10n` at project root — verify package ARB regeneration succeeds. (2) `cd example && flutter gen-l10n` — verify example ARB regeneration succeeds. (3) `flutter analyze` at project root — fix any errors or warnings. (4) `cd example && flutter analyze` — fix any errors or warnings. (5) Search for `getLocalizedString` in `lib/src/` — must find zero results. (6) Search for `MCalLocalizations()` constructor calls in `lib/src/widgets/` — must find zero results (all should be `MCalDateFormatUtils()` or `MCalLocalizations.of(context)`). (7) `flutter test` at project root — all tests must pass. (8) `cd example && flutter build apk --debug` — verify the example app builds. (9) Fix any issues found. Document all fixes. | Restrictions: Do not add new features. Only fix issues found during verification. | _Leverage: All created/modified files | _Requirements: All | Success: `flutter gen-l10n` succeeds for both. `flutter analyze` reports 0 errors for both. `flutter test` passes. Example app builds. Zero `getLocalizedString` calls in lib/src/. Mark task as in-progress in tasks.md before starting, log implementation with log-implementation tool after completion, then mark as complete._\n",
  "fileStats": {
    "size": 34390,
    "lines": 145,
    "lastModified": "2026-02-16T05:10:46.122Z"
  },
  "comments": []
}