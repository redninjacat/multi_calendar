{
  "id": "snapshot_1769911376238_hpaypytjp",
  "approvalId": "approval_1769911376234_zorfyds8o",
  "approvalTitle": "Month View Enhancements Design - Controller Architecture & Components",
  "version": 1,
  "timestamp": "2026-02-01T02:02:56.238Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis design document specifies the technical implementation for enhancing the MCalMonthView widget with additional features including hover support, keyboard navigation, programmatic navigation with displayDate/focusedDate, interactive overflow indicators, animations, enhanced styling, loading/error states, week numbers, performance optimizations, and accessibility enhancements.\n\nThe design builds upon the existing MCalMonthView implementation, extending it with new capabilities while maintaining backward compatibility.\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\n- **Widget Architecture**: Follows existing StatefulWidget pattern with controller integration\n- **Performance**: Maintains 60fps rendering with `const` constructors and `RepaintBoundary` widgets\n- **Dart Version**: Compatible with Dart 3.10.4+\n- **Flutter Patterns**: Uses ChangeNotifier, ThemeExtension, and Semantics widgets\n- **Mobile-First**: All enhancements work on mobile with optional desktop/web features (hover)\n\n### Project Structure (structure.md)\n\n- **File Organization**: New files follow existing naming conventions (`mcal_*.dart`)\n- **Naming**: Classes use `MCal` prefix, files use `mcal_` prefix\n- **Code Size**: Complex enhancements split into separate files (keyboard handler, animation controller)\n- **Testing**: Each enhancement has corresponding unit and widget tests\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **MCalEventController**: Extend with `displayDate` and `focusedDate` properties\n- **MCalMonthView**: Add new parameters without breaking existing API\n- **MCalThemeData**: Extend with new styling properties\n- **MCalDayCellContext**: Add `isFocused` property\n- **MCalLocalizations**: Extend with new localized strings for accessibility\n- **date_utils.dart**: Add ISO week number calculation\n\n### Integration Points\n\n- **Controller-View Communication**: Views listen via `addListener()`, react to displayDate/focusedDate changes\n- **Theme System**: New properties integrate with existing ThemeExtension pattern\n- **Accessibility**: Builds on existing Semantics widget usage\n\n## Architecture\n\n### Enhanced Controller-View Architecture\n\n```mermaid\ngraph TD\n    subgraph Controller[\"MCalEventController (Shared State)\"]\n        DD[displayDate: DateTime]\n        FD[focusedDate: DateTime?]\n        EV[events: Map]\n        LS[isLoading: bool]\n        ER[error: Object?]\n    end\n\n    subgraph View1[\"MCalMonthView\"]\n        V1FR[focusedRange: DateTimeRange]\n        V1VR[viewableRange: DateTimeRange]\n        V1KB[KeyboardHandler]\n        V1HV[HoverHandler]\n        V1AN[AnimationController]\n    end\n\n    subgraph View2[\"Future DayView\"]\n        V2FR[focusedRange: DateTimeRange]\n        V2VR[viewableRange: DateTimeRange]\n    end\n\n    Controller -->|notifyListeners| View1\n    Controller -->|notifyListeners| View2\n    View1 -->|setDisplayDate/setFocusedDate| Controller\n    View2 -->|setDisplayDate/setFocusedDate| Controller\n```\n\n### Component Hierarchy\n\n```\nMCalMonthView (StatefulWidget)\n├── _MCalMonthViewState\n│   ├── FocusNode (for keyboard input)\n│   ├── AnimationController (for transitions)\n│   ├── _NavigatorWidget\n│   ├── _WeekdayHeaderRowWidget\n│   │   └── _WeekNumberCell (optional)\n│   └── _MonthGridWithAnimations\n│       ├── _WeekRowWidget[]\n│       │   ├── _WeekNumberCell (optional)\n│       │   └── _DayCellWidget[]\n│       │       ├── MouseRegion (hover)\n│       │       ├── Semantics (accessibility)\n│       │       ├── Date label\n│       │       ├── Event tiles (with isAllDay styling)\n│       │       └── _OverflowIndicatorWidget (interactive)\n│       └── LoadingOverlay / ErrorOverlay\n└── MCalEventController (provided)\n```\n\n## Components and Interfaces\n\n### Component 1: Enhanced MCalEventController\n\n**Location**: `lib/src/controllers/mcal_event_controller.dart`\n\n**Purpose**: Manage shared state across all attached calendar views\n\n**New Properties and Methods**:\n\n```dart\nclass MCalEventController extends ChangeNotifier {\n  // Existing\n  final Map<String, MCalCalendarEvent> _eventsById = {};\n  \n  // New: Shared navigation state\n  DateTime _displayDate = DateTime.now();\n  DateTime? _focusedDate;\n  \n  // New: Loading/Error state\n  bool _isLoading = false;\n  Object? _error;\n  \n  // Getters\n  DateTime get displayDate => _displayDate;\n  DateTime? get focusedDate => _focusedDate;\n  bool get isLoading => _isLoading;\n  Object? get error => _error;\n  bool get hasError => _error != null;\n  \n  // Setters with notification\n  void setDisplayDate(DateTime date) {\n    if (_displayDate != date) {\n      _displayDate = date;\n      notifyListeners();\n    }\n  }\n  \n  void setFocusedDate(DateTime? date) {\n    if (_focusedDate != date) {\n      _focusedDate = date;\n      notifyListeners();\n    }\n  }\n  \n  // Convenience method\n  void navigateToDate(DateTime date, {bool focus = true}) {\n    final changed = _displayDate != date || (focus && _focusedDate != date);\n    _displayDate = date;\n    if (focus) {\n      _focusedDate = date;\n    }\n    if (changed) {\n      notifyListeners();\n    }\n  }\n  \n  // Loading state management\n  void setLoading(bool loading) {\n    if (_isLoading != loading) {\n      _isLoading = loading;\n      notifyListeners();\n    }\n  }\n  \n  void setError(Object? error) {\n    _error = error;\n    _isLoading = false;\n    notifyListeners();\n  }\n  \n  void clearError() {\n    if (_error != null) {\n      _error = null;\n      notifyListeners();\n    }\n  }\n  \n  // Retry mechanism\n  Future<void> retryLoad() async {\n    clearError();\n    final range = DateTimeRange(\n      start: DateTime(_displayDate.year, _displayDate.month - 1, 1),\n      end: DateTime(_displayDate.year, _displayDate.month + 2, 0),\n    );\n    await loadEvents(range.start, range.end);\n  }\n}\n```\n\n**Dependencies**: None (extends ChangeNotifier)\n\n### Component 2: Keyboard Navigation Handler\n\n**Location**: `lib/src/widgets/mcal_keyboard_handler.dart`\n\n**Purpose**: Handle keyboard input for calendar navigation\n\n**Interface**:\n\n```dart\n/// Mixin for keyboard navigation in calendar views\nmixin MCalKeyboardNavigationMixin<T extends StatefulWidget> on State<T> {\n  MCalEventController get controller;\n  DateTime? get minDate;\n  DateTime? get maxDate;\n  bool get enableKeyboardNavigation;\n  \n  /// Handle keyboard events\n  KeyEventResult handleKeyEvent(FocusNode node, KeyEvent event) {\n    if (!enableKeyboardNavigation) return KeyEventResult.ignored;\n    if (event is! KeyDownEvent) return KeyEventResult.ignored;\n    \n    final focusedDate = controller.focusedDate ?? controller.displayDate;\n    \n    switch (event.logicalKey) {\n      case LogicalKeyboardKey.arrowLeft:\n        _moveFocus(focusedDate.subtract(const Duration(days: 1)));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.arrowRight:\n        _moveFocus(focusedDate.add(const Duration(days: 1)));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.arrowUp:\n        _moveFocus(focusedDate.subtract(const Duration(days: 7)));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.arrowDown:\n        _moveFocus(focusedDate.add(const Duration(days: 7)));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.home:\n        _moveFocus(DateTime(focusedDate.year, focusedDate.month, 1));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.end:\n        _moveFocus(DateTime(focusedDate.year, focusedDate.month + 1, 0));\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.pageUp:\n        _navigateMonth(-1);\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.pageDown:\n        _navigateMonth(1);\n        return KeyEventResult.handled;\n      case LogicalKeyboardKey.enter:\n      case LogicalKeyboardKey.space:\n        _activateFocusedCell();\n        return KeyEventResult.handled;\n      default:\n        return KeyEventResult.ignored;\n    }\n  }\n  \n  void _moveFocus(DateTime newDate) {\n    // Clamp to min/max\n    if (minDate != null && newDate.isBefore(minDate!)) return;\n    if (maxDate != null && newDate.isAfter(maxDate!)) return;\n    \n    // Update focused date\n    controller.setFocusedDate(newDate);\n    \n    // If focus moves outside current month, update display\n    final displayMonth = DateTime(controller.displayDate.year, controller.displayDate.month);\n    final focusMonth = DateTime(newDate.year, newDate.month);\n    if (displayMonth != focusMonth) {\n      controller.setDisplayDate(newDate);\n    }\n  }\n  \n  void _navigateMonth(int delta) {\n    final current = controller.displayDate;\n    final newDate = DateTime(current.year, current.month + delta, 1);\n    controller.setDisplayDate(newDate);\n    // focusedDate unchanged - may go off-screen\n  }\n  \n  void _activateFocusedCell();\n}\n```\n\n**Dependencies**: Flutter's Focus system\n\n### Component 3: Hover Support Handler\n\n**Location**: Inline within `_DayCellWidget` and `_EventTileWidget`\n\n**Purpose**: Handle mouse hover events on desktop/web platforms\n\n**Implementation**:\n\n```dart\nclass _DayCellWidget extends StatelessWidget {\n  // ... existing fields ...\n  final void Function(DateTime, List<MCalCalendarEvent>, bool, bool)? onHoverCell;\n  \n  @override\n  Widget build(BuildContext context) {\n    Widget cell = _buildCellContent();\n    \n    // Wrap with MouseRegion for hover support\n    if (onHoverCell != null) {\n      cell = MouseRegion(\n        onEnter: (_) => onHoverCell!(date, events, isCurrentMonth, true),\n        onExit: (_) => onHoverCell!(date, events, isCurrentMonth, false),\n        child: cell,\n      );\n    }\n    \n    return cell;\n  }\n}\n```\n\n### Component 4: Month Transition Animator\n\n**Location**: `lib/src/widgets/mcal_month_animator.dart`\n\n**Purpose**: Animate transitions between months\n\n**Interface**:\n\n```dart\nclass MCalMonthAnimator extends StatefulWidget {\n  final Widget child;\n  final DateTime displayMonth;\n  final bool enableAnimations;\n  final Duration animationDuration;\n  final Curve animationCurve;\n  final MCalSwipeDirection? lastSwipeDirection;\n  \n  const MCalMonthAnimator({\n    required this.child,\n    required this.displayMonth,\n    this.enableAnimations = true,\n    this.animationDuration = const Duration(milliseconds: 300),\n    this.animationCurve = Curves.easeInOut,\n    this.lastSwipeDirection,\n    super.key,\n  });\n  \n  @override\n  State<MCalMonthAnimator> createState() => _MCalMonthAnimatorState();\n}\n\nclass _MCalMonthAnimatorState extends State<MCalMonthAnimator>\n    with SingleTickerProviderStateMixin {\n  late AnimationController _controller;\n  late Animation<Offset> _slideAnimation;\n  late Animation<double> _fadeAnimation;\n  \n  @override\n  Widget build(BuildContext context) {\n    if (!widget.enableAnimations) {\n      return widget.child;\n    }\n    \n    return AnimatedSwitcher(\n      duration: widget.animationDuration,\n      switchInCurve: widget.animationCurve,\n      switchOutCurve: widget.animationCurve,\n      transitionBuilder: (child, animation) {\n        // Slide animation based on navigation direction\n        final slideOffset = widget.lastSwipeDirection == MCalSwipeDirection.next\n            ? const Offset(1.0, 0.0)\n            : const Offset(-1.0, 0.0);\n        \n        return SlideTransition(\n          position: Tween<Offset>(\n            begin: slideOffset,\n            end: Offset.zero,\n          ).animate(animation),\n          child: FadeTransition(\n            opacity: animation,\n            child: child,\n          ),\n        );\n      },\n      child: KeyedSubtree(\n        key: ValueKey(widget.displayMonth),\n        child: widget.child,\n      ),\n    );\n  }\n}\n```\n\n### Component 5: Interactive Overflow Indicator\n\n**Location**: Enhanced `_OverflowIndicatorWidget` in `mcal_month_view.dart`\n\n**Purpose**: Display overflow indicator with tap/keyboard interaction\n\n**Interface**:\n\n```dart\nclass _OverflowIndicatorWidget extends StatelessWidget {\n  final int count;\n  final DateTime date;\n  final List<MCalCalendarEvent> allEvents;\n  final MCalThemeData theme;\n  final Locale locale;\n  final void Function(DateTime, List<MCalCalendarEvent>, int)? onOverflowTap;\n  final void Function(DateTime, List<MCalCalendarEvent>, int)? onOverflowLongPress;\n  final bool isFocusable; // For keyboard navigation\n  \n  @override\n  Widget build(BuildContext context) {\n    final indicator = Container(\n      padding: const EdgeInsets.symmetric(horizontal: 4, vertical: 2),\n      child: Text(\n        '+$count more',\n        style: theme.eventTileTextStyle?.copyWith(\n          fontStyle: FontStyle.italic,\n        ),\n      ),\n    );\n    \n    return Semantics(\n      label: '$count more events, tap to view all',\n      button: true,\n      child: GestureDetector(\n        onTap: () {\n          if (onOverflowTap != null) {\n            onOverflowTap!(date, allEvents, count);\n          } else {\n            _showDefaultOverflowSheet(context);\n          }\n        },\n        onLongPress: () {\n          if (onOverflowLongPress != null) {\n            onOverflowLongPress!(date, allEvents, count);\n          } else {\n            _showDefaultOverflowSheet(context);\n          }\n        },\n        child: indicator,\n      ),\n    );\n  }\n  \n  void _showDefaultOverflowSheet(BuildContext context) {\n    showModalBottomSheet(\n      context: context,\n      builder: (context) => _OverflowEventsList(\n        date: date,\n        events: allEvents,\n        theme: theme,\n        locale: locale,\n      ),\n    );\n  }\n}\n```\n\n### Component 6: Week Number Display\n\n**Location**: New widget `_WeekNumberCell` in `mcal_month_view.dart`\n\n**Purpose**: Display ISO 8601 week numbers\n\n**Implementation**:\n\n```dart\nclass _WeekNumberCell extends StatelessWidget {\n  final int weekNumber;\n  final DateTime firstDayOfWeek;\n  final MCalThemeData theme;\n  final Widget Function(BuildContext, MCalWeekNumberContext, Widget)? builder;\n  \n  @override\n  Widget build(BuildContext context) {\n    final defaultFormatted = '$weekNumber';\n    \n    Widget cell = Container(\n      padding: const EdgeInsets.symmetric(horizontal: 4, vertical: 8),\n      decoration: BoxDecoration(\n        color: theme.weekNumberBackgroundColor,\n      ),\n      child: Center(\n        child: Text(\n          defaultFormatted,\n          style: theme.weekNumberTextStyle,\n        ),\n      ),\n    );\n    \n    if (builder != null) {\n      final context = MCalWeekNumberContext(\n        weekNumber: weekNumber,\n        firstDayOfWeek: firstDayOfWeek,\n        defaultFormattedString: defaultFormatted,\n        theme: theme,\n      );\n      cell = builder!(context, context, cell);\n    }\n    \n    return cell;\n  }\n}\n\n// Utility function for ISO week number calculation\nint getISOWeekNumber(DateTime date) {\n  // ISO 8601: Week 1 is the week containing the first Thursday of the year\n  final jan4 = DateTime(date.year, 1, 4);\n  final dayOfYear = date.difference(DateTime(date.year, 1, 1)).inDays;\n  final weekday = date.weekday; // 1=Mon, 7=Sun\n  \n  // Calculate week number\n  int weekNumber = ((dayOfYear - weekday + 10) / 7).floor();\n  \n  // Handle edge cases (week 0 or week 53)\n  if (weekNumber == 0) {\n    // Last week of previous year\n    return getISOWeekNumber(DateTime(date.year - 1, 12, 31));\n  } else if (weekNumber == 53) {\n    // Check if it's actually week 1 of next year\n    final dec31 = DateTime(date.year, 12, 31);\n    if (dec31.weekday < 4) {\n      return 1;\n    }\n  }\n  \n  return weekNumber;\n}\n```\n\n### Component 7: Loading/Error Overlay\n\n**Location**: New widgets in `mcal_month_view.dart`\n\n**Purpose**: Display loading and error states\n\n**Implementation**:\n\n```dart\nclass _LoadingOverlay extends StatelessWidget {\n  final Widget Function(BuildContext, bool)? loadingBuilder;\n  \n  @override\n  Widget build(BuildContext context) {\n    if (loadingBuilder != null) {\n      return loadingBuilder!(context, true);\n    }\n    \n    return Container(\n      color: Colors.white.withOpacity(0.7),\n      child: const Center(\n        child: CircularProgressIndicator(),\n      ),\n    );\n  }\n}\n\nclass _ErrorOverlay extends StatelessWidget {\n  final Object error;\n  final VoidCallback onRetry;\n  final Widget Function(BuildContext, Object, VoidCallback)? errorBuilder;\n  \n  @override\n  Widget build(BuildContext context) {\n    if (errorBuilder != null) {\n      return errorBuilder!(context, error, onRetry);\n    }\n    \n    return Container(\n      color: Colors.white.withOpacity(0.9),\n      child: Center(\n        child: Column(\n          mainAxisSize: MainAxisSize.min,\n          children: [\n            const Icon(Icons.error_outline, size: 48, color: Colors.red),\n            const SizedBox(height: 16),\n            Text('Failed to load events'),\n            const SizedBox(height: 8),\n            ElevatedButton(\n              onPressed: onRetry,\n              child: const Text('Retry'),\n            ),\n          ],\n        ),\n      ),\n    );\n  }\n}\n```\n\n## Data Models\n\n### New Context Classes\n\n```dart\n/// Context for week number builder\nclass MCalWeekNumberContext {\n  final int weekNumber;\n  final DateTime firstDayOfWeek;\n  final String defaultFormattedString;\n  final MCalThemeData theme;\n  \n  const MCalWeekNumberContext({\n    required this.weekNumber,\n    required this.firstDayOfWeek,\n    required this.defaultFormattedString,\n    required this.theme,\n  });\n}\n\n/// Extended MCalDayCellContext with focus state\nclass MCalDayCellContext {\n  // Existing fields...\n  final DateTime date;\n  final bool isCurrentMonth;\n  final bool isToday;\n  final bool isSelectable;\n  final List<MCalCalendarEvent> events;\n  final MCalThemeData theme;\n  \n  // New field\n  final bool isFocused;\n  \n  const MCalDayCellContext({\n    required this.date,\n    required this.isCurrentMonth,\n    required this.isToday,\n    required this.isSelectable,\n    required this.events,\n    required this.theme,\n    this.isFocused = false,\n  });\n}\n```\n\n### Extended MCalThemeData\n\n```dart\nclass MCalThemeData extends ThemeExtension<MCalThemeData> {\n  // Existing properties...\n  \n  // New: Focused date styling\n  final Color? focusedDateBackgroundColor;\n  final TextStyle? focusedDateTextStyle;\n  \n  // New: All-day event styling\n  final Color? allDayEventBackgroundColor;\n  final TextStyle? allDayEventTextStyle;\n  final Color? allDayEventBorderColor;\n  final double? allDayEventBorderWidth;\n  \n  // New: Week number styling\n  final TextStyle? weekNumberTextStyle;\n  final Color? weekNumberBackgroundColor;\n  \n  // New: Hover state styling\n  final Color? hoverCellBackgroundColor;\n  final Color? hoverEventBackgroundColor;\n}\n```\n\n## New MCalMonthView Parameters\n\n```dart\nclass MCalMonthView extends StatefulWidget {\n  // Existing parameters...\n  \n  // New: Hover callbacks (Requirement 1)\n  final void Function(DateTime, List<MCalCalendarEvent>, bool, bool)? onHoverCell;\n  final void Function(MCalCalendarEvent, DateTime, bool)? onHoverEvent;\n  final void Function(MCalCalendarEvent, DateTime, bool)? onHoverTile; // Alias\n  \n  // New: Keyboard navigation (Requirement 2)\n  final bool enableKeyboardNavigation; // Default: true\n  \n  // New: Navigation callbacks (Requirement 3)\n  final void Function(DateTime)? onDisplayDateChanged;\n  final void Function(DateTimeRange)? onViewableRangeChanged;\n  final void Function(DateTime?)? onFocusedDateChanged;\n  final void Function(DateTimeRange)? onFocusedRangeChanged;\n  final bool autoFocusOnCellTap; // Default: true\n  \n  // New: Overflow callbacks (Requirement 4)\n  final void Function(DateTime, List<MCalCalendarEvent>, int)? onOverflowTap;\n  final void Function(DateTime, List<MCalCalendarEvent>, int)? onOverflowLongPress;\n  \n  // New: Animation parameters (Requirement 5)\n  final bool enableAnimations; // Default: true\n  final Duration animationDuration; // Default: 300ms\n  final Curve animationCurve; // Default: Curves.easeInOut\n  \n  // New: Overflow threshold (Requirement 7)\n  final int maxVisibleEvents; // Default: 3, 0 = show all\n  \n  // New: Loading/Error builders (Requirement 8)\n  final Widget Function(BuildContext, bool)? loadingBuilder;\n  final Widget Function(BuildContext, Object, VoidCallback)? errorBuilder;\n  \n  // New: Week numbers (Requirement 9)\n  final bool showWeekNumbers; // Default: false\n  final Widget Function(BuildContext, MCalWeekNumberContext, Widget)? weekNumberBuilder;\n  \n  // New: Accessibility (Requirement 11)\n  final String? semanticsLabel;\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Event Loading Failure**\n   - **Handling**: Controller sets error state, view shows error overlay\n   - **User Impact**: Sees error message with retry button, calendar grid still visible\n\n2. **Invalid Date Navigation**\n   - **Handling**: Clamp dates to minDate/maxDate range\n   - **User Impact**: Navigation disabled beyond boundaries\n\n3. **Keyboard Navigation Edge Cases**\n   - **Handling**: Prevent navigation beyond minDate/maxDate\n   - **User Impact**: Focus stays at boundary date\n\n4. **Animation Interruption**\n   - **Handling**: Cancel in-progress animations on new navigation\n   - **User Impact**: Smooth transition to new state\n\n## Testing Strategy\n\n### Unit Testing\n\n- **Controller State**: Test displayDate/focusedDate changes and notifications\n- **Week Number Calculation**: Test ISO 8601 algorithm with edge cases\n- **Date Range Calculations**: Test focusedRange/viewableRange for various months\n- **Keyboard Navigation Logic**: Test date movement with boundary conditions\n\n### Widget Testing\n\n- **Hover Events**: Test MouseRegion callbacks on desktop\n- **Keyboard Navigation**: Test Focus and key event handling\n- **Animation Transitions**: Test AnimatedSwitcher behavior\n- **Overflow Indicator**: Test tap/long-press and default bottom sheet\n- **Week Numbers**: Test display and RTL positioning\n- **Loading/Error States**: Test overlay display and retry\n\n### Integration Testing\n\n- **Multi-View Synchronization**: Test two views sharing controller\n- **Full Navigation Flow**: Keyboard + swipe + programmatic navigation\n- **Accessibility**: Test with screen reader simulation\n\n### Accessibility Testing\n\n- **Screen Reader Announcements**: Verify semantic labels are read correctly\n- **Keyboard-Only Navigation**: Full workflow without mouse/touch\n- **Focus Indicators**: Verify WCAG-compliant contrast\n\n## Performance Considerations\n\n### Rendering Optimizations\n\n1. **const Constructors**: Use throughout for static widgets\n2. **RepaintBoundary**: Wrap each day cell to isolate repaints\n3. **Cached Theme Resolution**: Resolve theme once per build, pass to children\n4. **Lazy Event Filtering**: Only filter events when month changes\n5. **Animation Efficiency**: Use AnimatedSwitcher with keys for efficient rebuilds\n\n### Memory Optimizations\n\n1. **Widget Reuse**: AnimatedSwitcher reuses widgets where possible\n2. **Event Caching**: Controller caches events, views don't duplicate\n3. **DateTime Caching**: Calculate grid dates once per month change\n\n### Gesture Performance\n\n1. **Swipe Velocity Threshold**: Prevent accidental swipes\n2. **Pre-loaded Events**: Enable instant month transitions\n3. **Animation Cancellation**: Stop animations when new navigation starts\n\n## Implementation Order\n\nRecommended implementation order based on dependencies:\n\n1. **Controller Enhancements** (displayDate, focusedDate, loading/error state)\n2. **Theme Extensions** (new styling properties)\n3. **Focus/Keyboard Navigation** (depends on controller)\n4. **Hover Support** (independent)\n5. **Animation System** (independent)\n6. **Overflow Interactions** (depends on existing overflow)\n7. **Week Numbers** (independent)\n8. **All-Day Styling** (extends existing)\n9. **Loading/Error States** (depends on controller)\n10. **Enhanced Accessibility** (depends on focus system)\n11. **Performance Optimizations** (can be done incrementally)\n",
  "fileStats": {
    "size": 23750,
    "lines": 785,
    "lastModified": "2026-02-01T02:02:49.184Z"
  },
  "comments": []
}