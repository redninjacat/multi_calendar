{
  "id": "snapshot_1769998245970_8uv9quubi",
  "approvalId": "approval_1769998245967_o91y3egwm",
  "approvalTitle": "Month View Enhancements Part 2 - Tasks",
  "version": 1,
  "timestamp": "2026-02-02T02:10:45.970Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\n\n## Phase 1: Theme System & InheritedWidget\n\n- [ ] 1. Create MCalTheme InheritedWidget\n  - File: lib/src/styles/mcal_theme.dart\n  - Add `MCalTheme` InheritedWidget class wrapping `MCalThemeData`\n  - Implement `MCalTheme.of(context)` with fallback chain: InheritedWidget → ThemeExtension → fromTheme()\n  - Implement `MCalTheme.maybeOf(context)` returning nullable without fallback\n  - Export from multi_calendar.dart\n  - Purpose: Enable theme access via context without passing through widget tree\n  - _Leverage: lib/src/styles/mcal_theme.dart existing MCalThemeData_\n  - _Requirements: 1.4, 1.5, 1.6_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer specializing in InheritedWidget patterns | Task: Create MCalTheme InheritedWidget in mcal_theme.dart with of(context) and maybeOf(context) static methods, implementing fallback chain to ThemeExtension then MCalThemeData.fromTheme() | Restrictions: Do not modify MCalThemeData class structure, ensure updateShouldNotify is implemented correctly | _Leverage: lib/src/styles/mcal_theme.dart | _Requirements: 1.4, 1.5, 1.6 | Success: MCalTheme.of(context) returns correct theme with proper fallback chain, maybeOf returns null when no theme available | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 2. Write unit tests for MCalTheme\n  - File: test/styles/mcal_theme_test.dart\n  - Test MCalTheme.of() with MCalTheme ancestor\n  - Test MCalTheme.of() fallback to ThemeExtension\n  - Test MCalTheme.of() fallback to fromTheme()\n  - Test MCalTheme.maybeOf() returning null\n  - Test updateShouldNotify behavior\n  - Purpose: Ensure theme inheritance chain works correctly\n  - _Leverage: test/styles/mcal_theme_test.dart existing patterns_\n  - _Requirements: 1.4, 1.5, 1.6_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Add unit tests for MCalTheme InheritedWidget covering of(), maybeOf(), and all fallback scenarios | Restrictions: Follow existing test patterns, test each fallback level independently | _Leverage: test/styles/mcal_theme_test.dart | _Requirements: 1.4, 1.5, 1.6 | Success: All fallback scenarios tested, updateShouldNotify behavior verified | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n## Phase 2: Callback API Standardization\n\n- [ ] 3. Create callback details classes\n  - File: lib/src/widgets/mcal_callback_details.dart (new file)\n  - Create MCalCellTapDetails class (date, events, isCurrentMonth)\n  - Create MCalEventTapDetails class (event, displayDate)\n  - Create MCalSwipeNavigationDetails class (previousMonth, newMonth, direction)\n  - Create MCalOverflowTapDetails class (date, allEvents, hiddenCount)\n  - Create MCalCellInteractivityDetails class (date, isCurrentMonth, isSelectable)\n  - Create MCalErrorDetails class (error, onRetry)\n  - Export from multi_calendar.dart\n  - Purpose: Standardized details objects for all callbacks\n  - _Leverage: lib/src/widgets/mcal_month_view_contexts.dart patterns_\n  - _Requirements: 1.1, 1.2, 1.3, 1.7-1.15_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Create new file mcal_callback_details.dart with all details classes per the design document, following existing context class patterns | Restrictions: All classes must be immutable with const constructors, do not include theme property | _Leverage: lib/src/widgets/mcal_month_view_contexts.dart | _Requirements: 1.1, 1.2, 1.3, 1.7-1.15 | Success: All 6 details classes created with proper documentation | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 4. Update existing context classes to remove theme\n  - File: lib/src/widgets/mcal_month_view_contexts.dart\n  - Remove `theme` property from MCalDayCellContext\n  - Remove `theme` property from MCalEventTileContext\n  - Remove `theme` property from MCalDayHeaderContext\n  - Remove `theme` property from MCalWeekNumberContext\n  - Update constructors and documentation\n  - Purpose: Theme now accessed via MCalTheme.of(context)\n  - _Leverage: lib/src/widgets/mcal_month_view_contexts.dart_\n  - _Requirements: 1.16_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Remove theme property from all existing context classes in mcal_month_view_contexts.dart, update constructors | Restrictions: Maintain all other properties, update documentation to reference MCalTheme.of(context) | _Leverage: lib/src/widgets/mcal_month_view_contexts.dart | _Requirements: 1.16 | Success: All context classes updated, no theme property, docs updated | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 5. Migrate existing callbacks to new signatures\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Update onCellTap signature: `void Function(BuildContext, MCalCellTapDetails)?`\n  - Update onCellLongPress signature: `void Function(BuildContext, MCalCellTapDetails)?`\n  - Update onEventTap signature: `void Function(BuildContext, MCalEventTapDetails)?`\n  - Update onEventLongPress signature: `void Function(BuildContext, MCalEventTapDetails)?`\n  - Update onSwipeNavigation signature: `void Function(BuildContext, MCalSwipeNavigationDetails)?`\n  - Update onOverflowTap signature: `void Function(BuildContext, MCalOverflowTapDetails)?`\n  - Update onOverflowLongPress signature: `void Function(BuildContext, MCalOverflowTapDetails)?`\n  - Update cellInteractivityCallback signature: `bool Function(BuildContext, MCalCellInteractivityDetails)?`\n  - Update errorBuilder signature: `Widget Function(BuildContext, MCalErrorDetails)?`\n  - Update all call sites to create and pass details objects\n  - Update all internal widgets that use theme to use MCalTheme.of(context)\n  - Purpose: Standardize all callbacks to (BuildContext, Details) pattern\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_callback_details.dart_\n  - _Requirements: 1.7-1.15_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Migrate all existing callbacks in MCalMonthView to new (BuildContext, Details) signatures, update all call sites to create details objects, update internal widgets to use MCalTheme.of(context) | Restrictions: Ensure all callback invocations pass BuildContext and correct details object, test that existing functionality still works | _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_callback_details.dart | _Requirements: 1.7-1.15 | Success: All callbacks use new signatures, all call sites updated, widget compiles without errors | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 6. Write tests for callback API changes\n  - File: test/widgets/mcal_month_view_test.dart\n  - Test onCellTap receives correct MCalCellTapDetails\n  - Test onEventTap receives correct MCalEventTapDetails\n  - Test onSwipeNavigation receives correct MCalSwipeNavigationDetails\n  - Test onOverflowTap receives correct MCalOverflowTapDetails\n  - Test cellInteractivityCallback receives correct details\n  - Test errorBuilder receives correct MCalErrorDetails\n  - Test MCalTheme.of(context) access from within builders\n  - Purpose: Verify callback migration works correctly\n  - _Leverage: test/widgets/mcal_month_view_test.dart existing patterns_\n  - _Requirements: 1.7-1.15_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Add/update widget tests to verify all migrated callbacks receive correct details objects and BuildContext | Restrictions: Test each callback type, verify details object properties are populated correctly | _Leverage: test/widgets/mcal_month_view_test.dart | _Requirements: 1.7-1.15 | Success: All callbacks tested with correct details, MCalTheme.of access verified | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n## Phase 3: Animation & PageView Navigation\n\n- [ ] 7. Add animation support to MCalEventController\n  - File: lib/src/controllers/mcal_event_controller.dart\n  - Add `_animateNextChange` private field (bool, default true)\n  - Add `shouldAnimateNextChange` getter\n  - Add `consumeAnimationFlag()` method to reset flag after use\n  - Update `setDisplayDate()` to accept optional `animate` parameter\n  - Add `navigateToDateWithoutAnimation()` convenience method\n  - Purpose: Allow programmatic control over navigation animation\n  - _Leverage: lib/src/controllers/mcal_event_controller.dart_\n  - _Requirements: 3.5, 3.6_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Add animation control to MCalEventController with animate parameter on setDisplayDate() and navigateToDateWithoutAnimation() method | Restrictions: Default behavior should remain animated, flag must be consumable | _Leverage: lib/src/controllers/mcal_event_controller.dart | _Requirements: 3.5, 3.6 | Success: Controller supports animate:false parameter, views can check shouldAnimateNextChange | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 8. Refactor MCalMonthView to use PageView\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Add PageController with initial index (10000 for \"infinite\" scrolling)\n  - Replace AnimatedSwitcher with PageView.builder\n  - Implement _pageIndexToMonth() and _monthToPageIndex() conversion methods\n  - Extract month grid to _MonthPage widget for PageView itemBuilder\n  - Implement _onPageChanged() to update controller and fire callbacks\n  - Update _navigateToMonth() to use PageController.animateToPage/jumpToPage\n  - Consume controller's shouldAnimateNextChange flag\n  - Wrap content in MCalTheme InheritedWidget\n  - Purpose: Enable PageView-style swipe navigation with peek preview\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, Flutter PageView_\n  - _Requirements: 2.1-2.11, 3.1-3.4, 3.7-3.10_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer with animation expertise | Task: Refactor MCalMonthView to use PageView.builder instead of AnimatedSwitcher, implementing infinite scrolling pattern with index offset, consuming controller animation flag | Restrictions: Maintain all existing functionality, ensure smooth 60fps animations, handle physics based on enableSwipeNavigation | _Leverage: lib/src/widgets/mcal_month_view.dart | _Requirements: 2.1-2.11, 3.1-3.4, 3.7-3.10 | Success: Swipe navigation works with peek preview, all navigation methods animate correctly, no visual glitches | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 9. Implement swipe boundary handling\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Add boundary detection in PageView physics\n  - Implement bounce-back behavior at minDate/maxDate boundaries\n  - Prevent page changes beyond boundaries\n  - Purpose: Respect minDate/maxDate restrictions during swipe\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, Flutter ClampingScrollPhysics_\n  - _Requirements: 2.9, 2.10_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Implement boundary handling for PageView swipe navigation, preventing navigation beyond minDate/maxDate with visual bounce-back feedback | Restrictions: Allow visual overscroll but snap back, don't allow page changes at boundaries | _Leverage: lib/src/widgets/mcal_month_view.dart | _Requirements: 2.9, 2.10 | Success: Swipe at boundaries shows bounce-back, cannot navigate past min/max dates | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 10. Write tests for animation and navigation\n  - File: test/widgets/mcal_month_view_test.dart\n  - Test PageView swipe navigation\n  - Test swipe callback fires with correct details\n  - Test boundary behavior at minDate/maxDate\n  - Test programmatic navigation with animate:true/false\n  - Test controller.navigateToDateWithoutAnimation()\n  - Test animation interruption on rapid navigation\n  - File: test/controllers/mcal_event_controller_test.dart\n  - Test setDisplayDate with animate parameter\n  - Test shouldAnimateNextChange flag behavior\n  - Test consumeAnimationFlag() resets to true\n  - Purpose: Verify PageView navigation and animation control\n  - _Leverage: test/widgets/mcal_month_view_test.dart, test/controllers/mcal_event_controller_test.dart_\n  - _Requirements: 2.1-2.11, 3.1-3.10_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Add tests for PageView navigation, swipe gestures, boundary handling, and controller animation flag | Restrictions: Test both animated and instant navigation, verify callback details | _Leverage: test/widgets/mcal_month_view_test.dart, test/controllers/mcal_event_controller_test.dart | _Requirements: 2.1-2.11, 3.1-3.10 | Success: All navigation scenarios tested, animation control verified | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n## Phase 4: Multi-Day Event Rendering\n\n- [ ] 11. Create MCalMultiDayRenderer utility\n  - File: lib/src/widgets/mcal_multi_day_renderer.dart (new file)\n  - Create MCalMultiDayEventLayout class (event, rowSegments)\n  - Create MCalMultiDayRowSegment class (weekRowIndex, startDayInRow, endDayInRow, flags)\n  - Implement _isMultiDay() helper to check if event spans multiple days\n  - Implement _multiDayEventComparator() for sorting (all-day multi → timed multi → all-day single → timed single)\n  - Implement calculateLayouts() to compute row segments for all multi-day events\n  - Purpose: Calculate layout information for contiguous multi-day tiles\n  - _Leverage: lib/src/utils/date_utils.dart_\n  - _Requirements: 4.5, 4.6_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Create MCalMultiDayRenderer utility class with layout calculation for multi-day events spanning week rows | Restrictions: Handle events spanning multiple weeks correctly, calculate row segment indices accurately | _Leverage: lib/src/utils/date_utils.dart | _Requirements: 4.5, 4.6 | Success: Layout calculations handle all edge cases (week wrap, month boundaries) | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 12. Create multi-day tile details class\n  - File: lib/src/widgets/mcal_callback_details.dart\n  - Add MCalMultiDayTileDetails class with all properties per design\n  - Purpose: Context for multi-day event tile builder\n  - _Leverage: lib/src/widgets/mcal_callback_details.dart_\n  - _Requirements: 4.8_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Add MCalMultiDayTileDetails class to mcal_callback_details.dart with all properties specified in design | Restrictions: Follow existing details class patterns, immutable with const constructor | _Leverage: lib/src/widgets/mcal_callback_details.dart | _Requirements: 4.8 | Success: MCalMultiDayTileDetails class created with all 12 properties | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 13. Create MCalMultiDayTile widget\n  - File: lib/src/widgets/mcal_multi_day_tile.dart (new file)\n  - Create widget that renders contiguous multi-day event tile\n  - Implement smart border radius calculation based on row position\n  - Support multiDayEventTileBuilder callback\n  - Implement tap/long-press with MCalEventTapDetails\n  - Purpose: Render individual multi-day event tile segment\n  - _Leverage: lib/src/widgets/mcal_month_view.dart _EventTileWidget patterns_\n  - _Requirements: 4.1-4.4, 4.7-4.9, 4.10, 4.11_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Create MCalMultiDayTile widget rendering contiguous tiles with smart corner radius, supporting custom builder | Restrictions: Use MCalTheme.of(context) for theme, handle RTL correctly, call callbacks with proper details | _Leverage: lib/src/widgets/mcal_month_view.dart | _Requirements: 4.1-4.4, 4.7-4.9, 4.10, 4.11 | Success: Tiles render with correct corners, builder receives all details, tap/long-press work | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 14. Integrate multi-day rendering into month grid\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Add renderMultiDayEventsAsContiguous parameter (default true)\n  - Add multiDayEventTileBuilder parameter\n  - Create _MultiDayEventRowsWidget to render spanning tiles at top of each week\n  - Update _WeekRowWidget to exclude multi-day events from regular cell rendering\n  - Integrate MCalMultiDayRenderer for layout calculations\n  - Update event sorting to use new ordering (per requirement 4.5)\n  - Purpose: Render multi-day events as contiguous tiles spanning cells\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_multi_day_renderer.dart_\n  - _Requirements: 4.1-4.12_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Integrate multi-day rendering into MCalMonthView, adding parameters and _MultiDayEventRowsWidget, updating event sorting and filtering | Restrictions: Maintain z-ordering so multi-day tiles don't overlap other content, preserve existing single-day rendering | _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_multi_day_renderer.dart | _Requirements: 4.1-4.12 | Success: Multi-day events render as contiguous tiles, event ordering correct, toggle works | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 15. Write tests for multi-day events\n  - File: test/widgets/mcal_multi_day_renderer_test.dart (new file)\n  - Test _isMultiDay() with various event spans\n  - Test event ordering comparator\n  - Test layout calculation for single-week events\n  - Test layout calculation for week-wrapping events\n  - Test layout calculation for month-boundary events\n  - File: test/widgets/mcal_month_view_test.dart\n  - Test renderMultiDayEventsAsContiguous true/false\n  - Test multiDayEventTileBuilder receives correct details\n  - Test tap on multi-day tile fires callback correctly\n  - Purpose: Verify multi-day rendering logic\n  - _Leverage: test/widgets/mcal_month_view_test.dart_\n  - _Requirements: 4.1-4.12_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Create tests for MCalMultiDayRenderer and multi-day tile rendering in MCalMonthView | Restrictions: Test edge cases (week wrap, month boundary), verify builder details | _Leverage: test/widgets/ | _Requirements: 4.1-4.12 | Success: All layout calculations tested, rendering toggle verified, builder tested | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n## Phase 5: Drag-and-Drop\n\n- [ ] 16. Create drag-related details classes\n  - File: lib/src/widgets/mcal_callback_details.dart\n  - Add MCalDraggedTileDetails class (event, sourceDate, currentPosition)\n  - Add MCalDragSourceDetails class (event, sourceDate)\n  - Add MCalDragTargetDetails class (event, targetDate, isValid)\n  - Add MCalDragWillAcceptDetails class (event, proposedStartDate, proposedEndDate)\n  - Add MCalDropTargetCellDetails class (date, isValid, draggedEvent)\n  - Add MCalEventDroppedDetails class (event, oldStartDate, oldEndDate, newStartDate, newEndDate)\n  - Purpose: Details objects for all drag-and-drop callbacks\n  - _Leverage: lib/src/widgets/mcal_callback_details.dart_\n  - _Requirements: 5.8-5.10, 5.13, 5.15, 5.17_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Add all drag-related details classes to mcal_callback_details.dart | Restrictions: Follow existing patterns, immutable const constructors | _Leverage: lib/src/widgets/mcal_callback_details.dart | _Requirements: 5.8-5.10, 5.13, 5.15, 5.17 | Success: All 6 drag details classes created | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 17. Create MCalDragHandler state manager\n  - File: lib/src/widgets/mcal_drag_handler.dart (new file)\n  - Create MCalDragHandler extending ChangeNotifier\n  - Implement drag state fields (draggedEvent, sourceDate, targetDate, isValid, position)\n  - Implement startDrag(), updateDrag(), completeDrag(), cancelDrag() methods\n  - Implement handleEdgeProximity() with Timer for edge navigation\n  - Implement delta calculation for multi-day event drops\n  - Purpose: Manage drag-and-drop state\n  - _Leverage: Flutter ChangeNotifier_\n  - _Requirements: 5.4-5.7, 5.16-5.19, 5.24-5.27, 5.28-5.30_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer with state management expertise | Task: Create MCalDragHandler ChangeNotifier managing drag state, edge navigation timer, and drop calculations | Restrictions: Properly dispose timer, calculate day delta correctly for multi-day events | _Leverage: Flutter ChangeNotifier | _Requirements: 5.4-5.7, 5.16-5.19, 5.24-5.27, 5.28-5.30 | Success: Drag state management complete, delta calculations correct | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 18. Create MCalDraggableEventTile wrapper\n  - File: lib/src/widgets/mcal_draggable_event_tile.dart (new file)\n  - Create widget wrapping event tiles with LongPressDraggable\n  - Support draggedTileBuilder for custom feedback widget\n  - Support dragSourceBuilder for custom source placeholder\n  - Implement default feedback (normal tile with elevation)\n  - Implement default source (50% opacity ghost)\n  - Purpose: Make event tiles draggable\n  - _Leverage: Flutter LongPressDraggable_\n  - _Requirements: 5.2-5.7, 5.8, 5.9_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Create MCalDraggableEventTile wrapping tiles with LongPressDraggable, supporting custom builders for feedback and source | Restrictions: Use 200ms delay for long-press, provide sensible defaults | _Leverage: Flutter LongPressDraggable | _Requirements: 5.2-5.7, 5.8, 5.9 | Success: Tiles are draggable via long-press, custom builders work, defaults look good | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 19. Integrate DragTarget into day cells\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Add enableDragAndDrop parameter (default false)\n  - Add draggedTileBuilder, dragSourceBuilder, dragTargetBuilder parameters\n  - Add onDragWillAccept, dropTargetCellBuilder, onEventDropped parameters\n  - Wrap _DayCellWidget content with DragTarget when enabled\n  - Implement onWillAcceptWithDetails with validation callback\n  - Implement visual feedback for valid/invalid targets\n  - Implement onAcceptWithDetails to complete drop\n  - Update event in controller and fire callback\n  - Handle callback return false to revert\n  - Purpose: Enable drop targets on day cells\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, Flutter DragTarget_\n  - _Requirements: 5.1-5.3, 5.10-5.19_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Add DragTarget integration to _DayCellWidget, implementing validation, visual feedback, and drop handling with controller update | Restrictions: Only enable when enableDragAndDrop is true, handle callback return values correctly | _Leverage: lib/src/widgets/mcal_month_view.dart, Flutter DragTarget | _Requirements: 5.1-5.3, 5.10-5.19 | Success: Drops work, validation callback respected, controller updated, revert on false | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 20. Implement cross-month drag navigation\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Add dragEdgeNavigationDelay parameter (default 500ms)\n  - Detect drag position near left/right edges\n  - Start timer when hovering at edge\n  - Navigate to previous/next month when timer fires\n  - Continue drag operation across month boundary\n  - Respect minDate/maxDate during edge navigation\n  - Handle drag cancellation at boundaries\n  - Purpose: Enable dragging events across month boundaries\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_drag_handler.dart_\n  - _Requirements: 5.20-5.23_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Implement edge detection and auto-navigation during drag, with configurable delay and boundary respect | Restrictions: Continue drag seamlessly across months, cancel timer when leaving edge, respect min/max dates | _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_drag_handler.dart | _Requirements: 5.20-5.23 | Success: Edge navigation works, delay configurable, boundaries respected | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 21. Add drag cancellation handling\n  - File: lib/src/widgets/mcal_month_view.dart\n  - Detect Escape key press during drag\n  - Detect drag outside calendar bounds (non-navigable edge)\n  - Animate tile back to original position on cancel\n  - Clean up drag state\n  - Purpose: Allow users to cancel drag operations\n  - _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_drag_handler.dart_\n  - _Requirements: 5.28-5.30_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Implement drag cancellation via Escape key and drag-out-of-bounds, with animated return to source | Restrictions: Clean up all drag state, ensure no memory leaks | _Leverage: lib/src/widgets/mcal_month_view.dart, lib/src/widgets/mcal_drag_handler.dart | _Requirements: 5.28-5.30 | Success: Escape cancels drag, out-of-bounds cancels, tile animates back | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 22. Write tests for drag-and-drop\n  - File: test/widgets/mcal_drag_handler_test.dart (new file)\n  - Test drag state transitions (start, update, complete, cancel)\n  - Test day delta calculation for drops\n  - Test multi-day event delta calculation\n  - Test edge navigation timer behavior\n  - File: test/widgets/mcal_month_view_test.dart\n  - Test enableDragAndDrop toggle\n  - Test long-press initiates drag\n  - Test onDragWillAccept validation\n  - Test onEventDropped receives correct details\n  - Test onEventDropped return false reverts event\n  - Test custom builders receive correct details\n  - Test cross-month drag navigation\n  - Test drag cancellation (escape, out-of-bounds)\n  - Purpose: Verify drag-and-drop functionality\n  - _Leverage: test/widgets/, Flutter test gesture utilities_\n  - _Requirements: 5.1-5.30_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Create comprehensive tests for MCalDragHandler and drag-and-drop functionality in MCalMonthView | Restrictions: Test all drag states, validation, callbacks, edge navigation, cancellation | _Leverage: test/widgets/ | _Requirements: 5.1-5.30 | Success: All drag scenarios tested, edge cases covered | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n## Phase 6: Example App & Polish\n\n- [ ] 23. Add drag-and-drop theme properties\n  - File: lib/src/styles/mcal_theme.dart\n  - Add dragTargetValidColor property\n  - Add dragTargetInvalidColor property\n  - Add dragSourceOpacity property\n  - Add draggedTileElevation property\n  - Add multiDayEventBackgroundColor property\n  - Add multiDayEventTextStyle property\n  - Update copyWith() and lerp() methods\n  - Update fromTheme() with defaults\n  - Purpose: Theme support for new features\n  - _Leverage: lib/src/styles/mcal_theme.dart_\n  - _Requirements: Design document theme properties_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Add new theme properties for drag-and-drop and multi-day events to MCalThemeData | Restrictions: Follow existing property patterns, provide sensible defaults in fromTheme() | _Leverage: lib/src/styles/mcal_theme.dart | _Requirements: Design document | Success: All new theme properties added with proper defaults | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 24. Update example app with new features\n  - File: example/lib/main.dart, example/lib/screens/\n  - Add toggle for renderMultiDayEventsAsContiguous\n  - Add toggle for enableDragAndDrop\n  - Add sample multi-day events\n  - Demonstrate custom multiDayEventTileBuilder\n  - Demonstrate drag-and-drop with visual feedback\n  - Add slider for dragEdgeNavigationDelay\n  - Demonstrate cross-month drag\n  - Purpose: Showcase all new features\n  - _Leverage: example/lib existing structure_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Developer | Task: Update example app to demonstrate all new features: PageView swipe, multi-day tiles, drag-and-drop, toggles | Restrictions: Keep example clear and educational | _Leverage: example/lib | _Requirements: All | Success: Example demonstrates all features, toggles work, looks polished | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 25. Update README documentation\n  - File: README.md\n  - Document new callback API pattern (BuildContext, Details)\n  - Document MCalTheme.of(context) usage\n  - Document swipe navigation\n  - Document multi-day event rendering\n  - Document drag-and-drop API\n  - Add code examples for each feature\n  - Purpose: Help developers use new features\n  - _Leverage: README.md existing structure_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Update README with documentation for all new features including callback pattern, theme access, swipe, multi-day tiles, and drag-and-drop | Restrictions: Follow existing README style, include code examples | _Leverage: README.md | _Requirements: All | Success: All new features documented with examples | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n\n- [ ] 26. Final integration testing\n  - File: test/integration/mcal_month_view_integration_test.dart\n  - Test full user flow: swipe navigation with multi-day events\n  - Test full user flow: drag event across months\n  - Test callback API consistency across all interaction types\n  - Test theme inheritance with nested widgets\n  - Purpose: Verify all features work together\n  - _Leverage: test/integration/_\n  - _Requirements: All_\n  - _Prompt: Implement the task for spec month-view-enhancements-part-2, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Flutter Test Engineer | Task: Add integration tests verifying all new features work together: swipe + multi-day + drag-and-drop | Restrictions: Test realistic user scenarios, verify no regressions | _Leverage: test/integration/ | _Requirements: All | Success: All features work together, no regressions | After completing the implementation, mark this task as in-progress in tasks.md, log the implementation with log-implementation tool, then mark as complete_\n",
  "fileStats": {
    "size": 35213,
    "lines": 360,
    "lastModified": "2026-02-02T02:10:38.138Z"
  },
  "comments": []
}